const kh_global=Function("return globalThis;")()||Function("return this;")()||Function("return self;")();const as_module=undefined==this;const asWorker="undefined"===typeof window&&"undefined"===typeof process&&self;const cf="kh_js";const mf="kh_classes2_esm";kh_global.kh??={};kh_global.kh.context??="undefined"!==typeof window?kh_global.parent==kh_global?"window":"iframe":"undefined"!==typeof process?"node.js":"undefined"!==typeof self?self.name??"worker":"unknown";kh_global.kh.storage??={};const cs=kh_global.kh.storage[cf]??={cf,ms:new Set};const ms=kh_global.kh.storage[mf]??={mf,cs};cs.ms.add(ms);let jsm_prefix;if("undefined"!==typeof process){jsm_prefix=`file:///${kh_global.kh.pathes.get("own-module")}`}else{jsm_prefix=nodeFN2ZK(`/contrib/jsm`)}let kh_js={};const print_level=undefined;let kh_log={};(async()=>{kh_js={...await import(`${jsm_prefix}/kh_earlybird${VERSION}.js`)};Object.assign(kh_js,await import(`${jsm_prefix}/kh_classes${VERSION}.js`))})().then((async()=>{kh_log={...await import(`${jsm_prefix}/kh_log${VERSION}.js`)};kh_log=new kh_log.Logger(print_level,(()=>MF`${mf}`))}));export class Map2Array extends Map{constructor(unique=false){super();this["#unique_"]=true===unique||"equals"==unique||"function"===typeof unique;this["compare_"]="equals"==unique?(v1,v2)=>v1?.equals(v2):"function"===typeof unique?unique:undefined}set(key,value){if(kh_js.isValid(value)&&!Array.isArray(value))throw new kh_js.Error({msg:["invalid-argument","value",value]});return super.set(key,value)}add(key,values){if(!kh_js.isValid(key)||kh_js.isEmpty(values))return;if(!Array.isArray(values))values=[values];let values_arr=this.get(key);if(!kh_js.isValid(values_arr))this.set(key,values_arr=[]);values=values.filter((value=>!this["#unique_"]||-1==(kh_js.isValid(this["compare_"])?values_arr.findIndex(this["compare_"].bind(null,value)):values_arr.indexOf(value))));values_arr.push(...values);return values}remove(key,values,remove_all=true){if(!kh_js.isValid(key)||kh_js.isEmpty(values))return;if(!Array.isArray(values))values=[values];let values_arr=this.get(key);if(!kh_js.isValid(values_arr))this.set(key,values_arr=[]);values=values.filter((value=>{let ret=undefined;let from_index=0;while(true){const idx=kh_js.isValid(this["compare_"])?values_arr.findIndex(this["compare_"].bind(null,value)):values_arr.indexOf(value,from_index);if(-1==idx)return ret;else{if(undefined==ret)ret=value;values_arr.splice(idx,1);if(this["#unique_"]||!remove_all)return ret;from_index=idx}}}));return values}has(key,values){if(kh_js.isEmpty(values))return super.has(key);else{const val=super.get(key);if(!Array.isArray(values))values=[values];return val?.includes(values)}}}export class FIFO{#c_=[];constructor(...vals){this.push(...vals??[])}get length(){return this.#c_.length}push(...vals){if(kh_js.isEmpty(vals))return;this.#c_.push(...vals)}pop(){return this.#c_.shift()}toArray(){return this.#c_}at(idx,val){if(undefined==val)return this.#c_.at(idx);else{idx=Math.trunc(idx)||0;if(0>idx)idx+=this.length;if(0>idx||this.length<=idx)throw new Error("IndexOutOfBounds");this.#c_[idx]=val}}}export class LIFO{#c_=[];constructor(...vals){this.push(...vals??[])}get length(){return this.#c_.length}push(...vals){if(kh_js.isEmpty(vals))return;this.#c_.push(...vals)}pop(){return this.#c_.pop()}toArray(){return this.#c_}at(idx,val){if(undefined==val)return this.#c_.at(idx);else{idx=Math.trunc(idx)||0;if(0>idx)idx+=this.length;if(0>idx||this.length<=idx)throw new Error("IndexOutOfBounds");this.#c_[idx]=val}}}kh_global.LoadedScripts.get(mf).resolve(ms);