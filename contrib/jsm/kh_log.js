var kh_global=kh_global||Function("return globalThis;")()||Function("return this;")()||Function("return self;")();const as_module=undefined==this;const asWorker="undefined"===typeof window&&"undefined"===typeof process&&self;const cf="kh_log";const mf="kh_log_esm";kh_global.kh??={};kh_global.kh.context??="undefined"!==typeof window?kh_global.parent==kh_global?"window":"iframe":"undefined"!==typeof process?"node.js":"undefined"!==typeof self?self.name??"worker":"unknown";kh_global.kh.storage??={};const cs=kh_global.kh.storage[cf]??={cf,ms:new Set};const ms=kh_global.kh.storage[mf]??={mf,cs};cs.ms.add(ms);let jsm_prefix;if("undefined"!==typeof process){jsm_prefix=`file:///${kh_global.kh.pathes.get("own-module")}`}else{jsm_prefix=nodeFN2ZK(`/contrib/jsm`)}const kh_js={...await import(`${jsm_prefix}/kh_earlybird${VERSION}.js`)};export function s2printLevel(level){if(kh_js.isNode&&!kh_js.isDevelopement)level=kh_global["kh-server-options"]?.[kh_js.Environment]?.loglevel||kh_global["kh-server-options"]?.loglevel||level;if(kh_js.isNumber(level,true))level=Number.parseInt(level)>>>0;else{switch(level){case"all":level=0;break;case"trace":level=1;break;case"debug":level=2;break;case"info":level=3;break;case"warn":level=4;break;case"error":level=5;break;case"fatal":level=6;break;default:level=7;break}}if(kh_js.isNode&&!kh_js.isDevelopement)level=Math.max(level??0,cs["first-valid-print-level"]??3);if(kh_js.isBrowser&&!kh_js.isDevelopement)level=Math.max(level??0,cs["first-valid-print-level"]??3);return level}let __kh_trace=function(){if(!kh_global["kh-trace-set"]){console["ori-trace"]=console.trace.bind(kh_global);console["trace"]=function(){console.log.apply(kh_global,[...arguments])};kh_global["kh-trace-set"]=true}return kh_global["kh-trace-set"]}();function find_token(arg,tok,def,tok_length){let pos_tok=kh_js.isEmpty(arg)||!kh_js.isString(arg)||undefined==tok||null==tok?-1:tok instanceof RegExp?arg.match(tok):arg.indexOf(tok);let found=tok instanceof RegExp?Array.isArray(pos_tok):-1!=pos_tok;tok_length=tok instanceof RegExp?found?pos_tok[0].length:0:tok_length||tok.length;if(tok instanceof RegExp&&found)pos_tok=pos_tok.index;let tok_val=found?arg.substring(pos_tok,pos_tok+tok_length):def;arg=found?arg.substring(0,pos_tok)+arg.substring(pos_tok+tok_length):arg;return[tok_val,arg]}let colorize4nodejs=99>kh_js.isChromium()&&!kh_js.isNode()||function _colorize4nodejs(){if(true!==kh_global.kh.storage["redirect-console-color"]){const green="[32m",yellow="[33m",red="[31m",cyan="[36m",reset="[0m";const colorz={trace:cyan,info:green,warn:yellow,error:red};let redirect=function(ct_key,color_str){const ori=console[ct_key];console[ct_key]=function(){const frmt_str=[...Array(arguments.length)].map((()=>color_str||colorz[ct_key])).join("%s ")+"%s"+reset;return ori.call(kh_global,frmt_str,...[...arguments].map((a=>a?.toString()??a)))};return console[ct_key]};Object.keys(colorz).forEach((console_type=>redirect(console_type)));kh_global.kh.storage["redirect-console-color"]=true}return true}();export function processObjects(strings,...keys){return keys.map(((key,i)=>strings[i]+kh_js.prettyPrint(key))).join("")+strings[strings.length-1]}kh_global.T9??=processObjects;export class Logger{constructor(print_level,f_scope){this.print_level_=s2printLevel(print_level??cs["first-valid-print-level"]??2);this.f_scope_=f_scope;cs["first-valid-print-level"]??=print_level;this.generateFuncs()}printLevel(new_print_level){if(undefined==new_print_level||null==new_print_level)return this.print_level_;[this.print_level_,new_print_level]=[s2printLevel(new_print_level),this.print_level_];this.generateFuncs();return new_print_level}print(){let f_arguments=arguments;if(0==f_arguments.length)return;if(7<=this.print_level_)return;let arg0,rest,scope_f;[arg0,...rest]=f_arguments;scope_f=rest&&rest.pop();if(!rest)rest="";if(typeof scope_f!=="function")rest=[...rest,scope_f];let level,not_space,not_lf,not_scope,not_timedate;[level,arg0]=find_token(arg0,/\^\d/,"^0",2);level=Number.parseInt(level.substring(1))>>>0;if(this.print_level_>level)return;[not_space,arg0]=find_token(arg0,"^*",false);[not_lf,arg0]=find_token(arg0,"^\n",false);[not_scope,arg0]=find_token(arg0,"^!",false);[not_timedate,arg0]=find_token(arg0,"^#",false);f_arguments=[];if(!kh_js.isEmpty(arg0))f_arguments.push(arg0);f_arguments.push(...rest);if(!not_scope&&typeof scope_f==="function")f_arguments=[scope_f()+(not_space?" ":""),...f_arguments];if(!not_timedate)f_arguments=[(new Date).toISOString(),...f_arguments];let out=not_space?[[].join.call(f_arguments,"")]:f_arguments;let con_type=2>level?"trace":3>level?"log":4>level?"info":5>level?"warn":"error";console?.[con_type]?.apply(kh_global,out)}with_level(level,...args){if(!args)return;let arg0,rest;[arg0,...rest]=args;arg0=`^${level}${arg0}`;this.print(arg0,...rest)}generateFuncs(level=this.print_level_){level=s2printLevel(level);const log_funcs=["write","trace","debug","info","warn","error","fatal"];log_funcs.forEach((func=>delete this[func]));log_funcs.forEach(((func,i)=>{this[func]=i>=level?function(){const f_arguments=this.f_scope_?[...arguments,this.f_scope_]:arguments;this.with_level(i,...f_arguments)}.bind(this):undefined}))}}kh_global.kh_log??=new Logger(undefined,(()=>MF`${"global"}`));kh_global.kh.storage.errorhandler??=function(){if("undefined"!==typeof window){window.addEventListener("rejectionhandled",(function(error_event){const error=error_event.reason;kh_global.kh_log.error?.(T9`*** rejectionhandled errro => ${error??"???"} / ${error?.stack??"N/A"} / ${error?.["#debug_info_"]??error_event?.["#debug_info_"]??"N/A"}`);return error_event.preventDefault()}));window.addEventListener("unhandledrejection",(function(error_event){const error=error_event.reason;kh_global.kh_log.error?.(T9`*** unhandledrejection errro => ${error??"???"} / ${error?.stack??"N/A"} / ${error?.["#debug_info_"]??error_event?.["#debug_info_"]??"N/A"}`);return error_event.preventDefault()}))}return true}();kh_global.LoadedScripts.get(mf).resolve(ms);