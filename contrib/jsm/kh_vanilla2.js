const kh_global=Function("return globalThis;")()||Function("return this;")()||Function("return self;")();const as_module=undefined==this;const asWorker="undefined"===typeof window&&"undefined"===typeof process&&self;const cf="kh_vanilla";const mf="kh_vanilla2_esm";kh_global.kh??={};kh_global.kh.context??="undefined"!==typeof window?kh_global.parent==kh_global?"window":"iframe":"undefined"!==typeof process?"node.js":"undefined"!==typeof self?self.name??"worker":"unknown";kh_global.kh.storage??={};const cs=kh_global.kh.storage[cf]??={cf,ms:new Set};const ms=kh_global.kh.storage[mf]??={mf,cs};cs.ms.add(ms);let jsm_prefix;let common_prefix;if("undefined"!==typeof process){jsm_prefix=`file:///${kh_global.kh.pathes.get("own-module")}`;common_prefix=`file:///${kh_global.kh.pathes.get("common")}`}else{jsm_prefix=nodeFN2ZK(`/contrib/jsm`)}const kh_js={...await import(`${jsm_prefix}/kh_earlybird${VERSION}.js`),...await import(`${jsm_prefix}/kh_functions${VERSION}.js`),...await import(`${jsm_prefix}/kh_classes${VERSION}.js`)};const{vjs}=await import(`${jsm_prefix}/kh_vanilla${VERSION}.js`);const name=MF`${mf}`;const print_level=undefined;const{Logger}=await import(`${jsm_prefix}/kh_log${VERSION}.js`);const kh_log=new Logger(print_level,(()=>name));cs.strings??=function(){const vjs_sm=new kh_js.StringMap({"vjs-switch-flag":"data-kh-switch","style.status.text":"","id.app.status":"app-status"});kh_js.StringMap.getGlobalMap().addEntries(vjs_sm);return vjs_sm}();export function install_resize_handler(){if(!kh_js.isValid(cs["orient-switch-handler"])){const def_switch_on=800;let switch_on=Number.parseInt(vjs.cssvar(vjs.body,"--orient-switch"))||def_switch_on;if(def_switch_on!=switch_on){function replace_switch_on(new_switch_on,old_switch_on){let new_switch_on_px=`${new_switch_on}px`;const old_switch_on_px=`${old_switch_on}px`;const no_replace=".kh-no-replace";[...document.styleSheets].forEach((ss=>{try{[...ss.cssRules||[]].filter((rule=>kh_js.isValid(rule.media)&&-1!=rule.media.mediaText.indexOf(old_switch_on_px)&&-1==[...rule.cssRules||[]].findIndex((css_rule=>-1!=css_rule.selectorText.indexOf(no_replace))))).forEach((rule=>{rule.media.mediaText=rule.media.mediaText.replace(old_switch_on_px,`${new_switch_on_px}`)}))}catch(error){kh_log.trace?.(`can't access CSS from ${ss.href} => ${error}`)}}))}replace_switch_on(switch_on,def_switch_on);replace_switch_on(switch_on+1,def_switch_on+1)}cs["orient-switch-handler"]=(event,fake)=>{if(!cs["orient-switch-handler-x"]||cs["orient-switch-handler-x"]<=switch_on^kh_global.innerWidth<=switch_on){const switch_flag=kh_global.kh.storage.kh_js.unzipString("vjs-switch-flag");const switch_value=kh_global.innerWidth<=switch_on?"vertical":"horizontal";vjs.html.setAttribute(switch_flag,switch_value);if(!fake)vjs.trigger(switch_flag,window,{switch_value})}cs["orient-switch-handler-x"]=kh_global.innerWidth};const vhw_setter=t_u=>{const vh=Math.min(window.innerHeight,window.outerHeight)*.01;const vw=Math.min(window.innerWidth,window.outerWidth)*.01;vjs.cssvar(vjs.html,"--vh",`${vh}px`);vjs.cssvar(vjs.html,"--vw",`${vw}px`);t_u.ticker=false};const vhs_ticker={ticker:false,updater:vhw_setter};vjs.on("resize",(event=>{cs["orient-switch-handler"](event,false);kh_js.requestTick(vhs_ticker)}),window);cs["orient-switch-handler"](null,true);vhw_setter(vhs_ticker)}}export async function onReadyStd(app_context,{string_tables=[],app_lang,force_secure=true,irh_flag=true}={}){if(false!==force_secure&&"https:"!==kh_global.location.protocol){kh_global.location.replace(`https:${kh_global.location.href.substring(location.protocol.length)}`)}if(kh_js.isValid(app_context)){app_context.subRoute??=(()=>{const pn=window.location.pathname;return 1<pn.length&&pn.endsWith("/")?pn.substring(0,pn.length-1):pn})();app_context.setStatus??=function(text,cat="err",delay_clear=1e4){let Șstatus=vjs(`#${app_context.unzip?.("id.app.status")??"status.bar"}`);if(kh_js.isEmpty(Șstatus))return;if(Array.isArray(Șstatus))Șstatus=Șstatus[0];text||="???";if(Array.isArray(text))Șstatus.append(...text);else if(kh_js.isDOMElement(text))Șstatus.append(text);else Șstatus.innerContent=T9`${text}`;(app_context.logger?.()??kh_log)["err"==cat?"error":"wrn"==cat?"warn":"info"]?.(T9`status: ${text}`);Șstatus.setAttribute("class",(app_context.unzip?.("class.app.status.stem")??"")+cat);if(-1!=delay_clear)kh_global.setTimeout((()=>{vjs.empty(Șstatus);Șstatus.setAttribute("class","")}),delay_clear)}}string_tables.forEach((string_table=>kh_js.StringMap.getGlobalMap().addEntries(string_table)));let browser_lang=kh_js.getBrowserLang({query:"html",attribute:"lang"});console.assert(browser_lang==kh_js.getAttribute2("html","lang",undefined,undefined,"attr").lang,"getLanguage() results must be equal");if(kh_js.isValid(app_lang))kh_js.setBrowserLang({query:"html",attribute:"lang",lang:app_lang});kh_js.StringMap.getGlobalMap().afterLocale();vjs.html.setAttribute("data-mobile",kh_js.isMobile()?"1":"0");vjs.html.setAttribute("data-touch",kh_js.isTouch()?"1":"0");vjs.html.setAttribute("data-browser",kh_js.getBrowserShort());if(false!=irh_flag)install_resize_handler()}export function NodeFromTemplate(template_name,as_string=false){if(kh_js.isEmpty(template_name)){const p=document.createElement("p");p.textContent=`template name - ${kh_global.kh.storage.kh_js.unzipString("param-not-determined")}`;return!as_string?p:p.outerHTML}try{let Ștemplate=vjs(`${template_name.startsWith("#")?"":"#"}${template_name}`,false);if(kh_js.isValid(Ștemplate))return!as_string?[...Ștemplate.content.children].map((c=>c.cloneNode(true))):Ștemplate.innerHTML;else{const p=document.createElement("p");p.textContent=`template - ${template_name} - ${kh_global.kh.storage.kh_js.unzipString("invalid-argument")}`;return!as_string?[p]:p.outerHTML}}catch(error){debugger}}export class Elements{static fromPhone(phones,sep="-",nnbsp=" "){if(kh_js.isEmpty(phones))return undefined;if(!Array.isArray(phones))phones=[phones];const parentNode=1<phones.length?document.createElement("div"):undefined;if(kh_js.isValid(parentNode)){parentNode.classList.add("kh-vlayout");vjs.cssvar(parentNode,"--gap-v",0)}const phone_nodes=phones.map((phone=>{const p=document.createElement("p");const a=document.createElement("a");p.textContent=`☎ `;p.insertAdjacentElement("beforeend",a);a.href=`tel:${phone.split(sep).join("")}`;a.textContent=phone.split(sep).join(nnbsp);return p}));if(kh_js.isValid(parentNode)){phone_nodes.forEach((pn=>parentNode.insertAdjacentElement("beforeend",pn)));return parentNode}else return phone_nodes[0]}static fromMailAddress(mailaddresses,crypt_shift,nnbsp=" "){if(kh_js.isEmpty(mailaddresses))return undefined;if(!Array.isArray(mailaddresses))mailaddresses=[mailaddresses];const parentNode=1<mailaddresses.length?document.createElement("div"):undefined;if(kh_js.isValid(parentNode)){parentNode.classList.add("kh-vlayout");vjs.cssvar(parentNode,"--gap-v",0)}const mailaddress_nodes=mailaddresses.map((mailaddress=>{const p=vjs.create("p",{text:`✉ `});const a=vjs.create("a",{href:kh_js.CryptMailto(mailaddress,crypt_shift),text:mailaddress.split("").join(nnbsp),dataType:"mail"},p);return p}));if(kh_js.isValid(parentNode)){mailaddress_nodes.forEach((pn=>parentNode.insertAdjacentElement("beforeend",pn)));return parentNode}else return mailaddress_nodes[0]}}export function MousePos(event,defPos={x:-1,y:-1}){return{x:event.touches?.[0]?.clientX??event.clientX??event.pageX??event.center?.x??rect.left??defPos.x,y:event.touches?.[0]?.clientY??event.clientY??event.pageY??event.center?.y??rect.top??defPos.y}}export function MousePos2Client(event,element=event.target){const rect=element.getBoundingClientRect();const mp=MousePos(event);return{x:mp.x-rect.left,y:mp.y-rect.top}}export function collectFromAttribute(id_base,attribute,id,event){const wgt_base=kh_js.getDOMObjectsFromStr(id_base);const elems=!kh_js.isEmpty(attribute)?vjs(wgt_base,`[${attribute}]`,true):undefined;const ids=vjs.attr(elems,"id")??[];let receiver=id||wgt_base||vjs(`#'div.kh-window-main`)||kh_global.zk&&jq("@window");if(!kh_global.zk)vjs.trigger(event||"onCollectFromAttribute",receiver,ret);else kh_js.sendEvent?.(vjs.attr(receiver[0]??receiver,"id"),event||"onCollectFromAttribute",ret?JSON.stringify(ret):ret)}export function getHtml4Download(selector,filename){const elements=vjs(selector);if(kh_js.isEmpty(elements))return;const content=elements.map((elem=>elem.textContent)).join("\n");return kh_js.downloadContent2File({content,filename})}Object.assign(cs,{collectFromAttribute});kh_global.LoadedScripts?.get(mf).resolve(ms);