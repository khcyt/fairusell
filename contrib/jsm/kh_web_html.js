const kh_global=Function("return globalThis;")()||Function("return this;")()||Function("return self;")();const as_module=undefined==this;const asWorker="undefined"===typeof window&&"undefined"===typeof process&&self;const cf="kh_web";const mf="kh_web_html_esm";kh_global.kh??={};kh_global.kh.context??="undefined"!==typeof window?kh_global.parent==kh_global?"window":"iframe":"undefined"!==typeof process?"node.js":"undefined"!==typeof self?self.name??"worker":"unknown";kh_global.kh.storage??={};const cs=kh_global.kh.storage[cf]??={cf,ms:new Set};const ms=kh_global.kh.storage[mf]??={mf,cs};cs.ms.add(ms);let jsm_prefix;let common_prefix;if("undefined"!==typeof process){jsm_prefix=`file:///${kh_global.kh.pathes.get("own-module")}`;common_prefix=`file:///${kh_global.kh.pathes.get("common")}`}else{jsm_prefix=nodeFN2ZK(`/contrib/jsm`)}const kh_js={...await import(`${jsm_prefix}/kh_earlybird${VERSION}.js`),...await import(`${jsm_prefix}/kh_classes${VERSION}.js`),...await import(`${jsm_prefix}/kh_functions${VERSION}.js`)};const print_level=undefined;const{Logger}=await import(`${jsm_prefix}/kh_log${VERSION}.js`);const kh_log=new Logger(print_level,(()=>name));const name=MF`${mf}`;const kh_cms=await import(`${jsm_prefix}/kh_cms${VERSION}.js`);const{vjs}=await import(`${jsm_prefix}/kh_vanilla${VERSION}.js`);const{dialog,info}=await import(`${jsm_prefix}/kh_components_popup${VERSION}.js`);export const copyright_dialog={stdTransform(copyrights){copyrights=Object.entries(copyrights).map((([key,copyright])=>{if("last"==key||"kh"==key)key=undefined;return kh_cms.LVC.tryLVC({label:copyright.txt,value:copyright.url,attributes:{[kh_js.WindowArgs.ui_model]:"copyright-line",[kh_js.WindowArgs.classz]:"copyright-line",lic:copyright.lic,key}})}));copyrights.splice(0,0,(this??copyright_dialog).headline());return copyrights},headline(){return kh_cms.LVC.tryLVC({label:"@(copyright.col.product)",value:"@(copyright.col.web)",attributes:{[kh_js.WindowArgs.ui_model]:"copyright-line-head",[kh_js.WindowArgs.classz]:"copyright-line-head",lic:"@(copyright.col.lic)"}})},vjsShow(options){let ȘmainWindow=vjs(options.mainWindow);if(kh_js.isEmpty(ȘmainWindow))ȘmainWindow=vjs(".kh-window-main",true);let Școpyright_dlg=vjs(options.copyrightDialog,false);if(kh_js.isEmpty(Școpyright_dlg))Școpyright_dlg=vjs(".copyright-dialog",false);return kh_js.Copyright.request(options.request).then((copyrights=>new Promise(((resolve,reject)=>{if(!kh_js.isValid(copyrights))return reject(new kh_js.Error({msg:["param-not-determined","Copyrights"]}));copyrights=copyright_dialog.stdTransform(copyrights);vjs.data(Școpyright_dlg,"content",copyrights);vjs.attr(Școpyright_dlg,"data-content","");vjs.onoff(kh_global.kh.storage.kh_js.unzipString("cms-event-children-tc"),((event,my_node_test)=>{if(my_node_test(event)){tooltip?.auto_create?.(Școpyright_dlg);resolve(true)}}),window,(event=>event.detail?.node?.equals(Școpyright_dlg)&&"content"==event.detail.key))})))).then((async()=>{const head=vjs(Școpyright_dlg,".copyright-line-head",false);let div=vjs.create("div",{class:"copyright-content-lines"});head.insertAdjacentElement("afterend",div);const Șall_lines=vjs(Școpyright_dlg,".copyright-line",true);div.append(...Șall_lines);vjs.onc("click",false,div,'a[href=""]:not(:empty)');vjs.style(vjs(div,'a[href=""]:not(:empty)',true),{cursor:"default",color:"var(--color-text)"});return[div,head]})).then((async elems=>{let popup_class="copyright-parent fit-content";if(!kh_js.isEmpty(options.dialog_options.popup_class)){popup_class+=` ${options.dialog_options.popup_class}`;delete options.dialog_options.popup_class}dialog({options:{popup_class,get_back:true,hide_icon:true,hide_cancel_button:true,...options.dialog_options},message:Școpyright_dlg,title:kh_global.kh.storage.kh_js.unzipString("copyright.title")});return elems})).then((async([div,head])=>{if(vjs.hasScrollBar(div))head.classList.add("kh-respect-scroll")})).catch((error=>kh_log.error?.(T9`error during show copyright dialog => ${error}`)))},jqShow(options){let $mainWindow=$(options.mainWindow);if(kh_js.isEmpty($mainWindow))$mainWindow=$(".kh-window-main");let $copyright_dlg=$(options.copyrightDialog);if(kh_js.isEmpty($copyright_dlg))$copyright_dlg=$(".copyright-dialog");const stdOptions={buttons:[{text:"OK",click:function(){$(this).dialog("destroy")}}],closeText:kh_cms.unzipProp("button-close",true,$mainWindow),resizable:false,position:{my:"center center",at:"center center",of:$mainWindow},title:kh_cms.unzipProp("copyright.title",true,$mainWindow),modal:true,classes:{"ui-dialog":"copyright-parent"}};options=$.ui.mergeOptions(stdOptions,options,"classes");return kh_js.Copyright.request(options.request).then((copyrights=>new Promise(((resolve,reject)=>{if(!kh_js.isValid(copyrights))return reject(new kh_js.Error({msg:["param-not-determined","Copyrights"]}));copyrights=copyright_dialog.stdTransform(copyrights);$copyright_dlg.attr("data-content","").data("content",copyrights);vjs.onoff(kh_global.kh.storage.kh_js.unzipString("cms-event-children-tc"),((event,my_node_test)=>{if(my_node_test(event)){tooltip?.auto_create?.($copyright_dlg);resolve(true)}}),window,(event=>event.detail?.node?.equals($copyright_dlg.get(0))&&"content"==event.detail.key))})))).then((async()=>{const $heads=$copyright_dlg.children(".copyright-line-head");let $div=$(document.createElement("div"));$div.attr({class:"copyright-content-lines"});$heads.last().after($div);const $all_lines=$copyright_dlg.children(".copyright-line");$div.append($all_lines);return[$div,$heads]})).then((async elems=>{$copyright_dlg.dialog(options);return elems})).then((async([$div,$heads])=>{!kh_js.isMobile()&&$copyright_dlg.dialog({position:options.position});if($div.hasScrollBar())$heads.addClass("kh-respect-scroll")})).catch((error=>kh_log.error?.(T9`error during show copyright dialog => ${error}`)))}};const legal_notice_link={prepare(entries){if(!kh_js.isValid(entries))entries=[];if(!Array.isArray(entries))entries=[entries];entries=entries.map((entry=>{let ui_model=entry[kh_js.WindowArgs.ui_model];entry=kh_cms.LVC.tryLVC(entry);if(!(entry instanceof kh_cms.LVC))entry=new kh_cms.LVC;ui_model=entry.getAttribute(kh_js.WindowArgs.ui_model)??ui_model??"legal-notice-link-element";entry.setAttribute(kh_js.WindowArgs.ui_model,ui_model);return entry}));return entries}};export const tooltip={class_icon:"kh-icon-tooltip",class_icon_auto:"kh-tooltip-auto",class_text:"kh-text-texttip",class_text_auto:"kh-texttip-auto",install(){kh_js.isMobile()?0:"on"==vjs.html.getAttribute("jQtt")&&kh_global.$&&$(document).tooltip?.({items:`*:not([class*="${tooltip.class_icon}"])`}),true},auto_create(base){base=vjs(base);if(kh_js.isEmpty(base))return;let Ștts=vjs(base,`[class*=${tooltip.class_icon_auto}][${kh_js.WindowArgs.title}]:not([${kh_js.WindowArgs.title}=""])`,true);Ștts.push(...vjs(base,`[class*=${tooltip.class_icon_auto}-after][${kh_js.WindowArgs.title}]:not([${kh_js.WindowArgs.title}=""])`,true)??[]);Ștts.push(...vjs(base,`[class*=${tooltip.class_icon_auto}-after][data-${kh_js.WindowArgs.title}-after]:not([data-${kh_js.WindowArgs.title}-after=""])`,true)??[]);Ștts.push(...vjs(base,`[class*=${tooltip.class_icon_auto}-before][${kh_js.WindowArgs.title}]:not([${kh_js.WindowArgs.title}=""])`,true)??[]);Ștts.push(...vjs(base,`[class*=${tooltip.class_icon_auto}-before][data-${kh_js.WindowArgs.title}-before]:not([data-${kh_js.WindowArgs.title}-before=""])`,true)??[]);Ștts.forEach(((elem,idx)=>{let title=elem.getAttribute(kh_js.WindowArgs.title);const title_after=elem.getAttribute(`data-${kh_js.WindowArgs.title}-after`);const title_before=elem.getAttribute(`data-${kh_js.WindowArgs.title}-before`);if(kh_js.isEmpty(title)&&kh_js.isEmpty(title_after)&&kh_js.isEmpty(title_before))return;const classz=[...elem.classList].filter((c=>c.startsWith(tooltip.class_icon_auto)));if(kh_js.isEmpty(classz))return;const new_parent=document.createElement("div");elem.before(new_parent);new_parent.append(elem);new_parent.setAttribute("style",elem.getAttribute("style"));elem.setAttribute("style","");classz.forEach((c=>{let insert_position="beforebegin";let tip=title;const span=document.createElement("span");switch(c){case`${tooltip.class_icon_auto}-after`:{if(!kh_js.isEmpty(title_after))tip=title_after;insert_position="afterend";break}case`${tooltip.class_icon_auto}-before`:if(!kh_js.isEmpty(title_before))tip=title_before;case tooltip.class_icon_auto:break;default:throw`kh - invalid tooltip action ${c}`}elem.insertAdjacentElement(insert_position,span);span.setAttribute(kh_js.WindowArgs.title,tip);span.classList.add(tooltip.class_icon)}));elem.classList.remove(...classz)}));vjs.onc("pointerdown",(event=>popup.show({s1:event.target.getAttribute(kh_js.WindowArgs.title),type:"popup-vjs"})),base,`[class*="${tooltip.class_icon}"]`)},auto_create_text(base){if(!kh_js.isTouch())return;base=vjs(base);if(kh_js.isEmpty(base))return;let Ștts=vjs(base,`[class*=${tooltip.class_text_auto}][${kh_js.WindowArgs.title}]:not([${kh_js.WindowArgs.title}=""])`,true);Ștts.push(...vjs(base,`[class*=${tooltip.class_text_auto}-above][${kh_js.WindowArgs.title}]:not([${kh_js.WindowArgs.title}=""])`,true)??[]);Ștts.push(...vjs(base,`[class*=${tooltip.class_text_auto}-above][data-${kh_js.WindowArgs.title}-above]:not([data-${kh_js.WindowArgs.title}-above=""])`,true)??[]);Ștts.push(...vjs(base,`[class*=${tooltip.class_text_auto}-below][${kh_js.WindowArgs.title}]:not([${kh_js.WindowArgs.title}=""])`,true)??[]);Ștts.push(...vjs(base,`[class*=${tooltip.class_text_auto}-below][data-${kh_js.WindowArgs.title}-below]:not([data-${kh_js.WindowArgs.title}-below=""])`,true)??[]);Ștts=Ștts.filter(vjs.isVisible);Ștts.forEach(((elem,idx)=>{let title=elem.getAttribute(kh_js.WindowArgs.title);const title_above=elem.getAttribute(`data-${kh_js.WindowArgs.title}-above`);const title_below=elem.getAttribute(`data-${kh_js.WindowArgs.title}-below`);if(kh_js.isEmpty(title)&&kh_js.isEmpty(title_above)&&kh_js.isEmpty(title_below))return;const classz=[...elem.classList].filter((c=>c.startsWith(tooltip.class_text_auto)));if(kh_js.isEmpty(classz))return;if(elem.classList.contains("direct")){elem.classList.add(tooltip.class_text);classz.forEach((c=>{let tip=title;switch(c){case`${tooltip.class_text_auto}-above`:{if(!kh_js.isEmpty(title_above))tip=title_above;elem.classList.add("above");vjs.cssvar(elem,"--texttip-text-above",tip);elem.setAttribute("data-texttip-text-above",tip);break}case`${tooltip.class_text_auto}-below`:if(!kh_js.isEmpty(title_below))tip=title_below;case tooltip.class_text_auto:{elem.classList.add("below");vjs.cssvar(elem,"--texttip-text-below",tip);elem.setAttribute("data-texttip-text-below",tip);break}default:throw`kh - invalid tooltip text action ${c}`}}))}else{const new_parent=document.createElement("div");elem.before(new_parent);new_parent.append(elem);new_parent.setAttribute("style",elem.getAttribute("style"));elem.setAttribute("style","");new_parent.classList.add("kh-vlayout");classz.forEach((c=>{let tip=title;const span=document.createElement("span");switch(c){case`${tooltip.class_text_auto}-above`:{if(!kh_js.isEmpty(title_above))tip=title_above;new_parent.classList.add("kh-reverse-order");break}case`${tooltip.class_text_auto}-below`:if(!kh_js.isEmpty(title_below))tip=title_below;case tooltip.class_text_auto:break;default:throw`kh - invalid tooltip text action ${c}`}elem.insertAdjacentElement("afterend",span);span.textContent=tip;span.classList.add(tooltip.class_text)}))}elem.classList.remove(...classz);let data_class=elem.getAttribute("data-class")?.split(" ");if(!kh_js.isEmpty(data_class)){classz.forEach((cl=>{const index=data_class.indexOf(cl);if(-1!=index)data_class.splice(index,1)}));elem.setAttribute("data-class",data_class.join(" "))}}))}};export const popup={close(argz){argz.self?.parent().fadeOut((()=>argz.self.dialog("close")))},show({s1="",s2="",options,message=s1,title="",data,type="popup-vjs"}={}){switch(type){case"popup-vjs":{info({options,message,title});break}case"popup-v1":case"popup-v2":{data??=new kh_cms.LVC({attributes:{ui_model:type,message,s2,title}});const Șdialog=vjs(vjs.NodeFromTemplate(type),"div",false);vjs.data(Șdialog,"each",data);$(Șdialog).on("dialogopen",(event=>kh_cms.processTemplateContent(event.target,undefined,"async")));$(Șdialog).dialog({classes:{"ui-dialog":"popup-parent"},modal:true,resizable:false});break}default:{data??=new kh_cms.LVC({attributes:{ui_model:type,message,title}});data.setAttribute("ui-model",type);const Șdialog=vjs.NodeFromTemplate(type);const div=document.createElement("div");vjs.data(div,"each",data);div.append(...Șdialog);dialog({message:div,title});kh_cms.processTemplateContent(div,undefined,"async");break}}}};export const input_line={create_func(elem){kh_js.defer(200).then((()=>!kh_js.isValid(input_line.input_id(elem))?input_line.create_func(elem):kh_cms.processTemplateContent(elem,["for"],"async")))},show_tt(argz){const elem=vjs(argz.self)?.[0];popup.show({s1:elem?.getAttribute(kh_js.WindowArgs.title)})},input_id(elem){return vjs.nextAll(elem,"input")?.[0]?.getAttribute("id")}};const dual_listbox={prepareEntries(entries){if(!kh_js.isValid(entries))entries=[];if(!Array.isArray(entries))entries=[entries];return entries.map((entry=>{let ui_model=entry[kh_js.WindowArgs.ui_model];entry=kh_cms.LVC.tryLVC(entry);if(!(entry instanceof kh_cms.LVC))entry=new kh_cms.LVC;ui_model=entry.getAttribute(kh_js.WindowArgs.ui_model)??ui_model??"dual-listbox-entry";entry.setAttribute(kh_js.WindowArgs.ui_model,ui_model);return entry}))},ListBox:class _ListBox{#elem_;#list_;constructor(elem){this.#elem_=vjs(elem)?.[0];vjs.data(this.#elem_,"listBox",this);this.#list_=vjs(this.#elem_,'[class*="-list-"]',false);vjs.on("keydown",(event=>this.onKey(event)),this.#elem_);vjs.onc("pointerdown",this.moveFrom.bind(this),this.#elem_,'[class*="button-move-from"]');vjs.onc("pointerdown",this.moveAllFrom.bind(this),this.#elem_,'[class*="button-move-all-from"]');vjs.onc("pointerdown",this.removeFrom.bind(this),this.#elem_,'[class*="button-remove-from"]');vjs.onc("pointerdown",this.setSelection.bind(this),this.#elem_,"li");vjs.onc("pointerdown",this.UpOrDown.bind(this),this.#elem_,'[class*="button-up-from"], [class*="button-down-from"]');vjs.onc("input",this.handleSearch.bind(this),this.#elem_,"input");this.setSelection(-1)}conntectTo(other){if(!(other instanceof _ListBox)){this.other_=undefined}else this.other_=other;this.checkButtons()}get isConnected(){return kh_js.isValid(this.other_)}get Șdom(){return this.#elem_}get Șlist(){return this.#list_}get data(){return vjs.data(this.#elem_,"each")?.value}set data(value){vjs.data(this.#elem_,"each").value=value}get selectedIndex(){return vjs.index(this.selectedItem)??-1}get selectedItem(){return vjs(this.#list_,':scope > [aria-selected="true"]')}get isSorted(){return"OL"==this.Șlist.tagName}get command(){return this.command_??kh_cms.attribute(this.Șdom,"each.attributes.command")}set command(new_command){this.command_=new_command}onKey(event){const Șactive_buttons=vjs(this.Șdom,'button:not([aria-disabled="true"])',true).filter(vjs.isVisible);let aria_keyshortcuts=Șactive_buttons?.map((btn=>btn.getAttribute("aria-keyshortcuts")?.split(" ")))?.flat()??[];const aria_keyshortcuts2=(vjs.attr(vjs(this.Șdom,'button:not([aria-disabled="true"])',true).filter(vjs.isVisible),"aria-keyshortcuts")??[])?.map((shorts=>shorts.split(" ")))?.flat();console.assert(aria_keyshortcuts.equals(aria_keyshortcuts2),"aria_keyshortcuts must be equal");let key=event.key;if("Alt"==key)return;if("Ctrl"==key)return;if(event.altKey){key=`Alt+${key}`}if(event.shiftKey){key=`Shift+${key}`}if(event.ctrlKey){key=`Ctrl+${key}`}let handled=false;switch(key){case"ArrowUp":case"ArrowDown":{let selindex=this.selectedIndex;if(-1!=selindex)this.setSelection((selindex+("ArrowDown"==key?+1:-1))%this.data.length);handled=true;break}default:{if(-1!=aria_keyshortcuts.indexOf(key)){const button=[...Șactive_buttons].find((btn=>-1!=btn.getAttribute("aria-keyshortcuts")?.split(" ").indexOf(key)));handled=true;const splitted=button?.getAttribute("id")?.split("-");switch(splitted?.[1]){case"move":"all"==splitted?.[2]?this.moveAllFrom():this.moveFrom();break;case"remove":this.removeFrom();break;case"up":case"down":this.UpOrDown(button);break;default:handled=false}}}}if(handled)return false}moveFrom(event){const entry=this.removeFrom(event);this.other_.addEntries(entry);return entry}moveAllFrom(event){const all_removed_entries=this.removeFrom(this.data);this.other_.addEntries(all_removed_entries);return all_removed_entries}removeFrom(event_or_entries){let entries;if(!kh_js.isValid(event_or_entries)||kh_js.isValid(event_or_entries?.target)){const selIndex=this.selectedIndex;if(-1==selIndex)return;entries=[this.data[selIndex]]}else{entries=event_or_entries;if(!Array.isArray(entries))entries=[entries];entries=entries.filter((entry=>entry instanceof kh_cms.LVC));if(kh_js.isEmpty(entries))return}this.data=this.data.filter((data=>-1==entries.findIndex((entry=>entry.equals(data)))));this.checkButtons(true);const command=this.command;!kh_js.isEmpty(command)&&kh_cms.doCommand(command,undefined,kh_cms.registeredMainwindows(),{what:"remove",entry:entries.map((entry=>entry.value)),list:this.data.map((entry=>entry.value))});return entries}addEntries(entries){if(!kh_js.isValid(entries))return;if(!Array.isArray(entries))entries=[entries];entries=entries.filter((entry=>entry instanceof kh_cms.LVC));if(kh_js.isEmpty(entries))return;const selIndex=this.selectedIndex;this.data=[...this.data,...entries];if(-1!=selIndex)this.setSelection(selIndex,true);else this.checkButtons(true);const command=this.command;!kh_js.isEmpty(command)&&kh_cms.doCommand(command,undefined,kh_cms.registeredMainwindows(),{what:"add",entries:entries.map((entry=>entry.value)),list:this.data.map((entry=>entry.value))})}UpOrDown(button_or_event,button){if(!kh_js.isValid(button_or_event))return;button??=button_or_event.target??button_or_event;const up=-1!=button.classList.value.indexOf("button-up-from");let selIndex=this.selectedIndex;if(-1==selIndex)return;const entry=this.data.splice(selIndex,1);selIndex+=up?-1:1;this.data.splice(selIndex,0,entry[0]);this.data=[...this.data];this.setSelection(selIndex,true);const command=this.command;!kh_js.isEmpty(command)&&kh_cms.doCommand(command,undefined,kh_cms.registeredMainwindows(),{what:"sort",list:this.data.map((entry=>entry.value))})}setSelection(event_or_item_or_index,defer=false){if(true==defer){vjs.one(kh_cms.unzipProp("cms-event-ready-tc"),(event=>{this.setSelection(event_or_item_or_index,false)}),window);return}const item=kh_js.isNumber(event_or_item_or_index)?0<=event_or_item_or_index?this.#list_.children.item(event_or_item_or_index):undefined:(event_or_item_or_index.target??event_or_item_or_index).closest("li");this.selectedItem?.setAttribute("aria-selected",false);item?.setAttribute("aria-selected",true);this.checkButtons()}checkButtons(defer=false){if(true==defer){vjs.one(kh_cms.unzipProp("cms-event-ready-tc"),(event=>{this.checkButtons()}),window);return}this.checkMoveButton();this.checkMoveAllButton();this.checkRemoveButton();this.checkUpDownButton()}checkMoveButton(){vjs.attr(vjs(this.#elem_,'[class*="button-move-from"]'),"aria-disabled",!this.isConnected||-1==this.selectedIndex)}checkMoveAllButton(){vjs.attr(vjs(this.#elem_,'[class*="button-move-all-from"]'),"aria-disabled",!this.isConnected||kh_js.isEmpty(this.data))}checkUpDownButton(){if(this.isSorted){const selIndex=this.selectedIndex;vjs.attr(vjs(this.#elem_,'[class*="button-down-from"]'),"aria-disabled",-1==selIndex||this.Șlist.children.length-1==selIndex);vjs.attr(vjs(this.#elem_,'[class*="button-up-from"]'),"aria-disabled",0>=selIndex)}}checkRemoveButton(){vjs.attr(vjs(this.#elem_,'[class*="button-remove-from"]'),"aria-disabled",-1==this.selectedIndex)}handleSearch(event){event=event.originalEvent??event;const text=event.detail?.toUpperCase();if(!kh_js.isEmpty(text)){[...this.Șlist.children].forEach((node=>{node=node;if(-1!=node.textContent.toUpperCase().indexOf(text))node.classList.remove("hide-it");else{node.classList.add("hide-it");if(this.selectedIndex==vjs.index(node))this.setSelection(-1)}}))}else[...this.Șlist.children].forEach((elem=>elem.classList.remove("hide-it")))}},DualListBox:class _DualListBox{#elem_;#left_;#right_;static#ns_=`.${name}.dl`;constructor(elem){this.#elem_=vjs(elem)?.[0];vjs.data(this.#elem_,"listBox",this);this.#left_=new dual_listbox.ListBox(vjs(this.#elem_,'div[class*="area-left"]',false));this.#right_=new dual_listbox.ListBox(vjs(this.#elem_,'div[class*="area-right"]',false));this.#left_.conntectTo(this.#right_);this.#right_.conntectTo(this.#left_);this.accept_button_=true==kh_cms.attribute(elem,"each.attributes.accept_button",true);if(this.accept_button_){this.#left_.command+=_DualListBox.#ns_;this.#right_.command+=_DualListBox.#ns_;this.data_left_=[...this.#left_.data];this.data_right_=[...this.#right_.data];vjs.on("keydown",this.onKey.bind(this),this.#elem_);vjs.on("pointerdown",this.accept.bind(this),this.#elem_.parentNode,'[class*="button-accept"]');vjs.on("pointerdown",this.reject.bind(this),this.#elem_.parentNode,'[class*="button-reject"]');vjs.on(`${this.#left_.command} ${this.#right_.command}`,(event=>{this.modified_=true;this.checkButtons()}),kh_cms.registeredMainwindows())}}get Șdom(){return this.#elem_}onKey(event){const Șactive_buttons=vjs(vjs.nextOne(this.Șdom,'[role="toolbar"]'),'button:not([aria-disabled="true"])',true).filter(vjs.isVisible);let aria_keyshortcuts=Șactive_buttons.map((btn=>btn.getAttribute("aria-keyshortcuts")?.split(" ")))?.flat()??[];let key=event.key;if("Alt"==key)return;if("Ctrl"==key)return;if(event.altKey){key=`Alt+${key}`}if(event.shiftKey){key=`Shift+${key}`}if(event.ctrlKey){key=`Ctrl+${key}`}let handled=false;if(-1!=aria_keyshortcuts.indexOf(key)){handled=true;const button=[...Șactive_buttons].find((btn=>-1!=btn.getAttribute("aria-keyshortcuts")?.split(" ").indexOf(key)));switch(button?.getAttribute("id")?.split("-")[1]){case"accept":this.accept();break;case"reject":this.reject();break;default:handled=false}}if(handled)return false}accept(){this.data_left_=[...this.#left_.data];this.data_right_=[...this.#right_.data];const ns=RegExp.sichere_zeichen(_DualListBox.#ns_);const rex=new RegExp(`^(.*?)(?:${ns})*$`);kh_cms.doCommand(this.#left_.command.trim(rex),undefined,kh_cms.registeredMainwindows(),{what:"accept",list:this.#left_.data.map((entry=>entry.value))});kh_cms.doCommand(this.#right_.command.trim(rex),undefined,kh_cms.registeredMainwindows(),{what:"accept",list:this.#right_.data.map((entry=>entry.value))});this.modified_=false;this.checkButtons()}reject(){this.#left_.data=[...this.data_left_];this.#right_.data=[...this.data_right_];this.modified_=false;this.checkButtons()}checkButtons(){vjs.attr(vjs(vjs.nextOne(this.Șdom,'[role="toolbar"]'),"button",true),"aria-disabled",!this.modified_)}},create(elem){kh_global.setTimeout((()=>new dual_listbox.DualListBox(elem)),250);return false},getListBoxes(elem,argz){elem=vjs(elem)?.[0];if(kh_js.isEmpty(elem))return undefined;if(true==argz?.empty_list)argz=undefined;argz??=vjs.data(elem,"argz");if(kh_js.isObject(argz)){let both=Object.entries(argz).filter((([key,value])=>key.startsWith("both_")));both.forEach((([key,value])=>{delete argz[key];const key_stem=key.substring(4);argz[`left${key_stem}`]=value;argz[`right${key_stem}`]=value}));argz=kh_js.partition_array(Object.entries(argz),(([key,value])=>key.startsWith("left_")));argz[0]=argz[0].map((([key,value])=>[key.substring(5),value]));argz[1]=argz[1].map((([key,value])=>[key.substring(6),value]));argz=argz.map((entry=>Object.fromEntries(entry)))}if(!Array.isArray(argz)||kh_js.isEmpty(argz))return;return argz.map(((entry,index)=>{if(!(entry instanceof kh_cms.LVC)){const label=entry.label;delete entry.label;const value=entry.list??[];delete entry.list;entry=new kh_cms.LVC({label,value,attributes:entry})}if(kh_js.isEmpty(entry.label))entry.label=0==index?"@(options-available)":"@(options-selected)";let preFix="ul";if(kh_js.isEmpty(entry.getAttribute(kh_js.WindowArgs.ui_model))){preFix=true==entry.getAttribute("sorted")?"ol":false==entry.getAttribute("sorted")?"ul":0==index?"ul":"ol";entry.setAttribute(kh_js.WindowArgs.ui_model,"dual-listbox-list")}entry.setAttribute("preFix",preFix);return entry}))},getToolBar(elem,curEach){elem=vjs(elem)?.[0];if(kh_js.isEmpty(elem))return undefined;if(true==curEach?.empty_list)curEach=undefined;curEach??=kh_cms.attribute(elem,"each",true);const preFix=curEach.getAttribute("preFix");const ret=new kh_cms.LVC({attributes:{preFix,postFix:dual_listbox.postFix(elem),...Object.fromEntries(curEach.attributes),[kh_js.WindowArgs.ui_model]:"dual-listbox-toolbar",enable_updown:"ol"==preFix}});return ret},postFix(elem){let area=elem.closest('[class*="area"]');if(!kh_js.isValid(area))area=elem.closest('[data-class*="area"]');return!kh_js.isValid(area)?"xxx":0==kh_cms.attribute(area,"forEachStatus.index",true)?"left":"right"}};Object.assign(cs,{legal_notice_link,tooltip,popup,input_line,dual_listbox});kh_global.LoadedScripts.get(mf).resolve(ms);