const kh_global=Function("return globalThis;")()||Function("return this;")()||Function("return self;")();const as_module=undefined==this;const asWorker="undefined"===typeof window&&"undefined"===typeof process&&self;const cf="kh_js";const mf="kh_functions_esm";kh_global.kh??={};kh_global.kh.context??="undefined"!==typeof window?kh_global.parent==kh_global?"window":"iframe":"undefined"!==typeof process?"node.js":"undefined"!==typeof self?self.name??"worker":"unknown";kh_global.kh.storage??={};const cs=kh_global.kh.storage[cf]??={cf,ms:new Set};const ms=kh_global.kh.storage[mf]??={mf,cs};cs.ms.add(ms);let jsm_prefix,js_prefix;let common_prefix;if("undefined"!==typeof process){jsm_prefix=`file:///${kh_global.kh.pathes.get("own-module")}`;common_prefix=`file:///${kh_global.kh.pathes.get("common")}`}else{js_prefix=nodeFN2ZK(`/contrib/js`);jsm_prefix=nodeFN2ZK(`/contrib/jsm`)}let kh_js={};const print_level=undefined;let kh_log;(async()=>{kh_js={...await import(`${jsm_prefix}/kh_earlybird${VERSION}.js`),...await import(`${jsm_prefix}/kh_classes${VERSION}.js`)}})().then((async()=>{const{Logger}=await import(`${jsm_prefix}/kh_log${VERSION}.js`);kh_log=new Logger(print_level,(()=>name))}));const name=MF`${mf}`;export function getSize(obj){return Object.getOwnPropertyNames(obj).length;let size=0;for(let key in obj){if(obj.hasOwnProperty(key))++size}return size}export function for_in(obj,f,_this=obj){if(!kh_js.isValid(obj)||"function"!==typeof f)return;const direct=null==Object.getPrototypeOf(obj);for(let key in obj){if(direct||obj.hasOwnProperty(key))f.call(_this,key,obj[key])}}export function find_in(obj,f,_this=obj){if("function"!==typeof f)return;for(let key in obj){if(key!="webkitStorageInfo"&&obj.hasOwnProperty(key))if(f.call(_this,key,obj[key]))return key}return undefined}export function removeEmpty(obj){for_in(obj,((key,value)=>{if(kh_js.isObject(value))removeEmpty(value);else if(!kh_js.isValid(value))delete this.key}));return obj}export function cloneObject(obj,use_keys=true){const m=new WeakMap;function inner_clone(o,target){try{if(!kh_js.isValid(o))return o;const tyn=kh_js.getTypeName(o);if("function"==typeof o){return o.clone()}if("symbol"==typeof o)return o;if("IncomingMessage"==tyn)return o;if("OutgoingMessage"==tyn)return o;if(o instanceof RegExp)return new RegExp(o);if(o instanceof Date)return new Date(o.getTime());if(kh_js.isString(o)||kh_js.isNumber(o)||"boolean"==typeof o)return JSON.parse(JSON.stringify(o));if("ImageData"==tyn)return new ImageData(o.data,o.width,o.height);if(kh_js.isjQuery(o))return $(o);if(Array.isArray(o))return o.map(inner_clone);if(o instanceof Map)return new Map([...o.entries()].map((entry=>[inner_clone(entry[0]),inner_clone(entry[1])])));if(o instanceof Set)return new Set([...o.values()].map(inner_clone));let ret=m.get(o);if(kh_js.isValid(ret))return ret;if("function"==typeof o["clone"])return o.clone();if(!kh_js.isPlainObject(o)){try{ret=new o.constructor}catch(error){ret=Object.create(Object.getPrototypeOf(o))}}if(undefined==ret||null==ret)ret={};m.set(o,ret);const keys=use_keys?Object.keys(o):Object.getOwnPropertyNames(o);keys.forEach((k=>ret[k]=inner_clone(o[k],ret)));return ret}catch(error){kh_log.error?.(T9`error in cloneObject() => ${error}`);return undefined}}return inner_clone(obj)}export function cloneJSON(o){return JSON.parse(JSON.stringify(o))}export function invertObject(obj,check_numeric=false){if(!kh_js.isValid(obj))return obj;const make_prop=val=>kh_js.isPlainObject(val)?JSON.stringify(val):val.toString();if(Array.isArray(obj)){return obj.reduce(((new_obj,cur,idx)=>(new_obj[make_prop(cur)]=idx,new_obj)),{})}else{const entries=Object.entries(obj);const is_numeric=check_numeric&&entries.every((entry=>kh_js.isNumber(entry[1],true)&&entry[1].toString()==(entry[1]|0).toString()));if(is_numeric)return entries.reduce(((new_arr,cur)=>(new_arr[cur[1]|0]=cur[0],new_arr)),[]);else return entries.reduce(((new_obj,cur)=>(new_obj[make_prop(cur[1])]=cur[0],new_obj)),{})}}export function make_unique(array){if(kh_js.isEmpty(array))return array;if("Set"in kh_global){return Array.from(new Set(array))}const prims={boolean:{},number:{},string:{}},objs=[];return array.filter((function(item){const type=typeof item;if(type in prims)return prims[type].hasOwnProperty(item)?false:prims[type][item]=true;else return 0<=objs.indexOf(item)?false:objs.push(item)}))}export function subset(obj,...keys){if(1==keys.length&&"function"===typeof keys[0]){return subset(obj,...Object.keys(obj).filter((k=>keys[0](k))))}return keys.reduce(((a,c)=>({...a,[c]:obj[c]})),{})}export function bind_args_from_n(ƒ,n,...bound_args){return function(...args){return ƒ(...args.slice(0,n-1),...bound_args,...args.slice(n-1))}}export const bind1st=(ƒ,_1st)=>bind_args_from_n(ƒ,1,_1st);export const bind2nd=(ƒ,_2nd)=>bind_args_from_n(ƒ,2,_2nd);export const not=ƒ=>function(){return!ƒ(...arguments)};export function flipArgz(func){return function(){return func(...[...arguments].reverse())}}export const indexOfMaxValue=(array,cmp_f)=>array.reduce(((iMax,cur_val,cur_idx)=>("function"==typeof cmp_f?1<=cmp_f(cur_val,array[iMax]):cur_val>array[iMax])?cur_idx:iMax),0);export const indexOfMinValue=(array,cmp_f)=>array.reduce(((iMin,cur_val,cur_idx)=>("function"==typeof cmp_f?-1>=cmp_f(cur_val,array[iMax]):cur_val<array[iMin])?cur_idx:iMin),0);export function shuffle_array(array){if(kh_js.isEmpty(array))return array;for(let i=array.length-1;0<i;--i){const j=Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]]}return array}export function partition_array(array,filter){return array?.reduce((([pass,fail],elem,index)=>filter(elem,index)?[[...pass,elem],fail]:[pass,[...fail,elem]]),[[],[]])}export function getRandomArbitrary(min=0,max){return Math.random()*((max||Number.MAX_SAFE_INTEGER||1<<31>>>0)-min)+min}export function generatePassword(length=20,wishlist="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz~!@-#$"){const crypto=kh_global.crypto??require("crypto");const randomFunc=crypto?.getRandomValues?.bind(crypto)??crypto?.randomFillSync?.bind(crypto)??(arr=>arr.map((v=>getRandomArbitrary(0,1<<31>>>0)>>>0)));return Array.from(randomFunc(new Uint32Array(length))).map((x=>wishlist[x%wishlist.length])).join("")}export function romanize(num){let lookup={M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1},roman="";for(let i in lookup){while(num>=lookup[i]){roman+=i;num-=lookup[i]}}return roman}export function deromanize(roman_str){let str=(roman_str||"").toUpperCase(),validator=/^M*(?:D?C{0,3}|C[MD])(?:L?X{0,3}|X[CL])(?:V?I{0,3}|I[XV])$/,token=/[MDLV]|C[MD]?|X[CL]?|I[XV]?/g,key={M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1},num=0,m;if(!(str&&validator.test(str)))return false;while(m=token.exec(str))num+=key[m[0]];return num}export function check4Field(obj,fieldname,init_value){if(!kh_js.isValid(obj)||kh_js.isEmpty(fieldname))return false;if(!obj.hasOwnProperty(fieldname)){let value_=undefined!==init_value?init_value:{};Object.defineProperty(obj,fieldname,{configurable:true,enumerable:true,writeable:true,get:function(){return value_},set:function(v){value_=v}})}else{let descr=Object.getOwnPropertyDescriptor(obj,fieldname)}return true}export function addField(obj,fieldname,fg,fs){if(!kh_js.isValid(obj))return;if(!kh_js.isValid(fieldname)&&kh_js.isValid(obj.obj)&&kh_js.isValid(obj.fieldname)){return addField(obj.obj,obj.fieldname,obj.fg,obj.fs)}else{if(!kh_js.isValid(fieldname)||obj.hasOwnProperty(fieldname))return;let methName=fieldname.charAt(0).toUpperCase()+fieldname.substring(1);obj["get"+methName]=function(){if(!check4Field(this,fieldname))return null;return null!=fg?fg.call(this):this[fieldname]};obj["set"+methName]=function(fv){if(!check4Field(this,fieldname,fv))return;null!=fs?fs.call(this,fv):this[fieldname]=fv}}}export function deferF(f,t=1e3){if("function"!=typeof f)return f;f=f.bind(this);return function(){const argz=[f,t,...arguments];kh_global.setTimeout.apply(null,argz)}}export const defer=(t,v)=>new Promise((resolve=>kh_global.setTimeout((()=>resolve(v)),t)));export function toBytesUint32(num,littleEndian){const arr=new ArrayBuffer(4);const view=new DataView(arr);view.setUint32(0,num>>>0,littleEndian);return arr}export function toBytesUint64(num,littleEndian){if(!kh_js.isString(num)||16<num.length)return undefined;if(16>num.length)num="0".repeat(16-num.length)+num;const bytes=num.match(/../g).map((s=>parseInt(s,16)));const arr=new ArrayBuffer(8);const i8arr=new Int8Array(arr);bytes.forEach(((b,i)=>i8arr[i]=b));return arr}export const getTimestamp=function(){const has_performance=kh_global.performance&&kh_global.performance.now&&kh_global.performance.timing&&kh_global.performance.timing.navigationStart;return has_performance?function(){return kh_global.performance.now()+kh_global.performance.timing.navigationStart}:function(){return Date.now()}}();export function getTimestamp4FileName(){let tp=(new Date).toISOString();tp=tp.substring(0,tp.indexOf("."));return tp.replace("T","-").replace(/:/g,"-")}const camelizeRE=/-(\w)/g;export function toCamelCase(str){return str?.replace(camelizeRE,((_,c)=>c?c.toUpperCase():""))}function toKebabOrSnakeCase(str,join_sign,lazy=false){if(Array.isArray(str))str=str.filter((s=>!kh_js.isEmpty(s))).join(join_sign);if(!kh_js.isString(str))return str;if(lazy){return str.match(/[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g)?.map((x=>x.toLowerCase()))?.join(join_sign)??str.trim(/^(?:[^a-zA-Z0-9]*)([a-zA-Z0-9]*)(?:[^a-zA-Z0-9]*)$/)}else{const matches=[...str.matchAll(/[A-Z]{2,}(?=[A-Z][a-z]+[0-9]*|\b)|[A-Z]?[a-z]+[0-9]*|[A-Z]|[0-9]+/g)];if(kh_js.isEmpty(matches))return str;return`${str.substring(0,matches[0].index)}${matches.map((match=>match[0].toLowerCase())).join(join_sign)}${str.substring(matches.at(-1).index+matches.at(-1)[0].length)}`}}export function toKebabCase(str,lazy=false){return toKebabOrSnakeCase(str,"-")}export function toSnakeCase(str,lazy=false){return toKebabOrSnakeCase(str,"_")}export function realizeShariff(){if(!kh_global.Shariff)return;[...kh_global.document?.documentElement?.children?.[1]?.querySelectorAll(".shariff")||[]].forEach((elem=>{if(elem.hasOwnProperty("shariff"))elem.shariff=new Shariff(elem)}))}export function open_doc(url,title,options){if(kh_js.isEvent(url,false)){url=url.target.href}if(kh_js.isEmpty(url)||!kh_js.isValid(window))return false;options||=`toolbar=${window.toolbar?.visible?"yes":"no"},location=${window.locationbar?.visible?"yes":"no"},menubar=${window.menubar?.visible?"yes":"no"},`+`scrollbars=${window.scrollbars?.visible?"yes":"no"},status=${window.statusbar.visible?"yes":"no"},resizable=yes`;const w=window.open(url,title||"_blank",options);try{w.focus()}catch(e){}return false}export function getHtml(id_from,ph_s){const wgt_from=getDOMObjectNativeFromStr(id_from);const div=document.createElement("div");let dom_recv=undefined;try{dom_recv=getDOMObjectNativeFromStr(ph_s);if("INPUT"!=dom_recv.tagName)throw new Error({msg:["param-invalid","ph_s","invalid-type",dom_recv.tagName]})}catch(e){dom_recv=undefined}div.appendChild(wgt_from.cloneNode(true));if(dom_recv){dom_recv.focus(true);dom_recv.value=div.innerHTML;dom_recv.blur();defer(500).then((()=>{dom_recv.focus();dom_recv.value="";dom_recv.blur()}))}else{try{let f=new Function("s_html",ph_s);f(div.innerHTML)}catch(e){kh_log.warn?.(T9`Check parameter «${ph_s}» for getHTML()`)}}}export function getDOMObjectsFromStr(selector,strict=true){if(kh_js.isEmpty(selector))return selector;if(kh_js.isjQuery(selector))return selector;const jq=kh_global.jq||kh_global.$;if(kh_js.isZK(selector))return jq?.(selector)||selector;const allowed_start=kh_global.zk?["#","$","@",".","["]:["#",".","["];const preferred=kh_global.zk?"$":"";const can_prefix=kh_js.isValid(kh_global.zk)&&-1==allowed_start.indexOf(selector.charAt(0));let ret=kh_js.isValid(jq)?jq(can_prefix?preferred+selector:selector):[...document.querySelectorAll(selector)];if(kh_js.isEmpty(ret)&&kh_js.isValid(jq)&&kh_global.jq==jq){if(can_prefix&&true!==strict)ret=jq("#"+selector);if(kh_js.isEmpty(ret)&&can_prefix)ret=jq(selector)}return ret}export function getDOMObjectNativeFromStr(selector,strict=true){const jq=kh_global.jq||kh_global.$;const ret=getDOMObjectsFromStr(selector,strict);return kh_js.isValid(jq)?ret?.get(0):ret?.[0]}export function getDOMObjectsNativeFromStr(selector,strict=true){const jq=kh_global.jq||kh_global.$;const ret=getDOMObjectsFromStr(selector,strict);return kh_js.isValid(jq)?ret?.toArray():ret}let sendEvent;let getWidgetFromStrOrId;if(kh_global.jq&&kh_global.zk){sendEvent=function(id,event="onEvent",data){if(!kh_js.isValid(id))return;zAu.send(new zk.Event(getWidgetFromStrOrId(id),event,data,{toServer:true}),10)};getWidgetFromStrOrId=function(id,strict){if(!kh_js.isValid(id)||!kh_js.isValid(kh_global.zk))return undefined;const is_string=kh_js.isString(id);const prefixed=is_string&&-1!=["#","$","@",".","["].indexOf(id.charAt(0));let wgt=is_string?zk.Widget.$(prefixed?id:"$"+id):kh_js.isZK(id)?id:zk.Widget.$(id);if(!wgt&&true!==strict&&!prefixed)wgt=zk.Widget.$("#"+id);return wgt}}else{sendEvent=function(){};getWidgetFromStrOrId=function(){}}export{sendEvent,getWidgetFromStrOrId};export function downloadContent2File({content,filename=`content_${getTimestamp4FileName()}`,mime_type,node,auto_remove,auto_click}={}){if(kh_js.isEmpty(content))return;let revokeObjectURL=false;if(content instanceof Blob){content=URL.createObjectURL(content);revokeObjectURL=true}auto_remove??=!kh_js.isValid(node);auto_click=auto_remove||(auto_click??=!kh_js.isValid(node));const anchor=document.createElement("a");const parent=auto_remove?document.body:node;anchor.href=content.startsWith("/")||content.startsWith("blob:")||content.startsWith("data:")?content:"data:attachment/text,"+encodeURI(content);anchor.download=encodeURI(filename);anchor.type=mime_type;anchor.textContent=auto_remove?"":decodeURI(filename)??"download";anchor.target="_self";parent.appendChild(anchor);if("showSaveFilePicker"in kh_global&&!auto_remove){anchor.addEventListener("click",(event=>{(()=>kh_global.showSaveFilePicker({suggestedName:decodeURI(filename)??"download"}).then((async newHandle=>Promise.all([import(`${jsm_prefix}/kh_earlybird${VERSION}.js`),newHandle.createWritable()]))).then((async([{getBinaryFromDataURL},writableStream])=>[getBinaryFromDataURL(content),writableStream])).then((async([blob,writableStream])=>Promise.all([writableStream.write(blob),writableStream]))).then((async([_,writableStream])=>writableStream.close())))();event.stopPropagation();event.preventDefault();return false}));auto_click=false}if(auto_click)anchor.click();if(auto_remove){anchor.remove();if(revokeObjectURL)URL.revokeObjectURL(content)}return{anchor:auto_remove?undefined:anchor,content:revokeObjectURL?undefined:content}}export function getFile4Upload({multiple=false}={}){let input=document.createElement("input");input.setAttribute("type","file");input.setAttribute("multiple","");return new Promise((function(resolve,reject){const test_cancel=e=>{setTimeout((()=>{if(kh_js.isValid(input)&&kh_js.isEmpty(input.value)){kh_log.trace?.("cancel pressed");input.remove();input=undefined;reject("cancel")}}),250);document.body.onfocus=null};input.onclick=e=>{document.body.onfocus=test_cancel};input.onchange=e=>{if(!kh_js.isValid(input))debugger;const result=multiple?input.files:input.files[0];input.remove();input=undefined;resolve(result)};input.click()}))}export function getFileContent4Upload({multiple=false,content_type="text",encoding="utf-8",files}={}){if(kh_js.isValid(files))multiple=Array.isArray(files);return(!kh_js.isValid(files)?getFile4Upload({multiple}):Promise.resolve(files)).then((file_s=>{file_s=multiple?[...file_s]:[file_s];file_s=file_s.map((file=>new Promise(((resolve,reject)=>{let reader=new FileReader;switch(content_type){case"dataurl":reader.readAsDataURL(file);break;case"binarystring":reader.readAsBinaryString(file);break;case"arraybuffer":reader.readAsArrayBuffer(file);break;default:reader.readAsText(file,encoding);break}reader.onload=event=>resolve(event.target.result);reader.onerror=event=>reject(event.type)}))));return Promise.all(file_s).then((content_s=>Promise.resolve(multiple?content_s:content_s[0])))})).catch((error=>Promise.reject(error)))}export function setAttribute_(selector,attr_name,value){const jq=kh_global.jq||kh_global.$;try{const json=JSON.parse(attr_name);jq(selector).attr(json)}catch(e){jq(selector).attr(attr_name,value)}}export function getAttribute(id,ph_s,attr_name){const node=jq("#"+id)[0];const tmp=getDOMObjectNativeFromStr(ph_s);if("INPUT"!==tmp.tagName)return;tmp.focus();tmp.value=node.getAttribute(attr_name);tmp.blur();tmp.value=""}export function getAttribute2(id_from,attr_name,id_recv,event,what="css"){let dom_from="prop"==what&&id_from&&kh_js.isZK(id_from)?id_from:getDOMObjectNativeFromStr(id_from);if(!kh_js.isValid(dom_from)||!attr_name)return;const jq=kh_global.jq||kh_global.$;const get_what=function(name){let value="css"==what?!kh_js.isValid(jq)?window.getComputedStyle(dom_from).getPropertyValue(name):jq(dom_from).css(name):"attr"==what?!kh_js.isValid(jq)?dom_from.getAttribute(name):jq(dom_from).attr(name):dom_from[name];if(kh_js.isValid(value)||"prop"!==what)return value;if("zk"in kh_global&&!kh_js.isZK(dom_from)){dom_from=getWidgetFromStrOrId(id_from);value=dom_from?.[name];if(kh_js.isValid(value))return value}if(kh_js.isjQuery(dom_from)){dom_from=dom_from.get(0);value=dom_from?.[name]}return value};let ret={};attr_name=Array.isArray(attr_name)?attr_name:[attr_name];attr_name.forEach(((_attr_name,idx)=>{const value=get_what(_attr_name);if(value)ret[_attr_name]=value}));if(kh_global.zk){const wgt_recv=getWidgetFromStrOrId(id_recv??id_from);if(wgt_recv){kh_log.trace?.("send event for property get: ",attr_name,"  -> ",JSON.stringify(ret));sendEvent(wgt_recv,event||"onGetAttribute",JSON.stringify(ret))}}return ret}export function scrollIntoView(id,options=true){const element=getDOMObjectNativeFromStr(id);if(!kh_js.isValid(element))return;element.scrollIntoView(options)}export function getClientPosition(id,id_recv,event){if(!id)return;let xPos=0;let yPos=0;while(id){if(id.tagName=="BODY"){let xScroll=id.scrollLeft||document.documentElement.scrollLeft;let yScroll=id.scrollTop||document.documentElement.scrollTop;xPos+=id.offsetLeft-xScroll+id.clientLeft;yPos+=id.offsetTop-yScroll+id.clientTop}else{xPos+=id.offsetLeft-id.scrollLeft+id.clientLeft;yPos+=id.offsetTop-id.scrollTop+id.clientTop}id=id.offsetParent}let pos={x:xPos,y:yPos};if("zk"in kh_global){let recv=getWidgetFromStrOrId(id_recv);if(recv)sendEvent(recv,event||"onClientPosition",JSON.stringify(pos))}return pos}function EventName2DOM(en){if(kh_js.isEmpty(en))return en;return(0==en.indexOf("on")?en.substring(2):en).toLowerCase()}export function getDOMEvent(event,strict=false){event=event.originalEvent??event.srcEvent??event.domEvent??event;return!strict||event instanceof Event?event:undefined}export function cloneEvent(old_event,new_event_type,new_bubble,new_target){if(!old_event||!new_target||!(old_event instanceof Event)&&!(old_event instanceof PointerEvent)&&!(kh_global.$&&old_event instanceof $.Event)&&!(kh_global.zk&&old_event instanceof zk.Event))throw new Error("invalid parameters","event");const domEvent=getDOMEvent(old_event);let newDOMEvent=undefined;if("boolean"===typeof new_bubble){let cloned_attrs={};for(let key in domEvent){if("function"!==typeof domEvent[key]&&key.split("").find((function(cur,idx,arr){return cur!==cur.toUpperCase()})))cloned_attrs[key]=domEvent[key]}cloned_attrs.currentTarget=cloned_attrs.target=new_target;cloned_attrs.bubbles=new_bubble;newDOMEvent=new domEvent.constructor(EventName2DOM(new_event_type)||domEvent.type,cloned_attrs)}else newDOMEvent=new domEvent.constructor(EventName2DOM(new_event_type)||domEvent.type,old_event);return old_event instanceof Event?newDOMEvent:old_event instanceof kh_global.$.Event?new $.Event(newDOMEvent.type,newDOMEvent):new kh_global.zk.Event(zk.Widget.$(new_target),new_event_type||old_event.name,old_event.data,old_event.opt,newDOMEvent)}export function disable_pointer(cur_ref_id,popup_id,parent_selector){let $parent_selector=getDOMObjectsFromStr(parent_selector);let $cur_ref=getDOMObjectsFromStr(cur_ref_id);let $popup=getDOMObjectsFromStr(popup_id);if(kh_js.isEmpty($cur_ref)||kh_js.isEmpty($popup)||kh_js.isEmpty($parent_selector))return;let $cur=undefined;if(1==$parent_selector.length){$cur=$parent_selector}else{do{if(-1!=$parent_selector.index($cur_ref.get(0))){$cur=$cur_ref;break}$cur_ref=$cur_ref.parent()}while(!kh_js.isEmpty($cur_ref))}if(!kh_js.isEmpty($cur)){let pointer_events_cur=$cur.css("pointer-events");let css={"pointer-events":"none"};$cur.css(css);$popup.get(0)["kh-pointer-events"]=function(){$cur.css({"pointer-events":pointer_events_cur})}}}export function simulateHref(url,reset_query){if(reset_query){let must_slash=false==window.location.pathname.endsWith("/");window.history.pushState({},document.title,window.location.pathname+(url?(must_slash?"/":"")+url:""))}if(url&&reset_query){const jq=kh_global.jq||kh_global.$;let node_bm=jq(url);if(!kh_js.isEmpty(node_bm))node_bm=node_bm.get(0);if(kh_js.isValid(node_bm)){let nLeft=0,nTop=0;for(;node_bm;node_bm=node_bm.offsetParent){nLeft+=node_bm.offsetLeft;nTop+=node_bm.offsetTop}document.documentElement.scrollTop=nTop;document.documentElement.scrollLeft=nLeft}}else if(url)window.location.href=url}export function getGeoLocation(id,event_name){if(!window.navigator.geolocation)return sendEvent(id,event_name,"Geolocation is not supported");window.navigator.geolocation.getCurrentPosition((position=>kh_js.isjQuery(id)?id.trigger(new $.Event(event_name,JSON.stringify({latitude:position.coords.latitude,longitude:position.coords.longitude}))):sendEvent(id,event_name,JSON.stringify({latitude:position.coords.latitude,longitude:position.coords.longitude}))))}export function testPopupEnabled(){return new Promise((function(resolve,reject){const test=window.open(null,"","width=1,height=1");setTimeout((function(){if(test&&test.innerHeight&&test.innerHeight>0){test.close();resolve()}else reject()}),20)}))}export function CryptMailto(mailaddress,shift){if(kh_js.isEmpty(mailaddress))return"";if(!mailaddress.startsWith("mailto:"))mailaddress="mailto:"+mailaddress;let encrypted_mailaddress="";for(let i=0;i<mailaddress.length;++i){let n=mailaddress.charCodeAt(i);if(8364<=n)n=128;encrypted_mailaddress+=String.fromCharCode(n+shift)}return encrypted_mailaddress}export function UnCryptMailto(encrypted_mailaddress,shift){if(kh_js.isEmpty(encrypted_mailaddress))return"";let mailaddress="";for(let i=0;i<encrypted_mailaddress.length;++i){let n=encrypted_mailaddress.charCodeAt(i);if(8364<=n)n=128;mailaddress+=String.fromCharCode(n-shift)}return mailaddress}export function linkTo_UnCryptMailto(encrypted_mailaddress,shift){if(encrypted_mailaddress.startsWith(`${kh_global.location.origin}/`))encrypted_mailaddress=encrypted_mailaddress.substring(kh_global.location.origin.length+1);const ma=UnCryptMailto(encrypted_mailaddress,shift||4);const a=document.createElement("a");a.href=ma;document.body.appendChild(a);a.click();document.body.removeChild(a)}(function(){let jq=kh_global.jq||kh_global.$;if(!jq)return true;jq.fn.extend({nextOne:function(selector){return this.nextAll(selector).first()},nextIncl:function(selector){return this.nextUntil(this.nextOne(selector).next())},hasScrollBar:function(){return this.get(0).scrollHeight>this.height()},post:function(event_type,event_data,native=false){const o_this=this;return new Promise(((resolve,reject)=>resolve(true))).then((result=>!native?o_this.trigger(event_type,event_data):o_this.triggerNative(event_type,event_type instanceof $.Event?undefined:{detail:event_data})))},triggerNative:function(event,{bubbles=false,cancelable=false,composed=false,detail}={}){if(!kh_js.isValid(event))return;if(event instanceof $.Event)event=new CustomEvent(event.type,{detail:event.data,bubbles,cancelable,composed});if(kh_js.isString(event))event=kh_js.isValid(detail)?new CustomEvent(event,{detail,bubbles,cancelable,composed}):new Event(event,{bubbles,cancelable,composed});this.each(((idx,elem)=>{elem.dispatchEvent(event)}))},equals:function(o){return kh_js.isValid(o)&&this.length==o.length&&this.length==this.filter(o).length},onoff:function(arg_events,opt_selector,opt_data,arg_handler,arg_canceler){if(3>arguments.length)throw`invalid usage of $.onoff() for event ${event}`;let argz=[...arguments];let canceler=argz.pop(),handler=argz.pop();let proxy,o_this=this;return this.on(...argz,proxy=function(){let ret="boolean"==typeof handler&&handler||"function"==typeof handler&&handler(...arguments,canceler);if("boolean"==typeof canceler&&canceler||"function"==typeof canceler&&canceler(...arguments))o_this.off(argz[0],proxy);return ret})},data$attr:function(key,value,skip_attr=false){if(undefined==value){return this.data(key)??(!skip_attr?this.attr(`data-${key}`):undefined)}else{if("undefined"==value){this.removeData(key);if(!skip_attr)this.attr(`data-${key}`,null)}else{this.data(key,value);if(!skip_attr)this.attr(`data-${key}`,kh_js.isString(value)?value:JSON.stringify(value))}return this}},isParent:function(elem,strict=false){if(!kh_js.isjQuery(elem))elem=$(elem);if(kh_js.isEmpty(elem))return false;if(!strict||1>=this.length)return!kh_js.isEmpty(this.parents().filter(elem));else{return this.length==this.filter(((idx,one_from_this)=>$(one_from_this).isParent(elem,true))).length}},getIFrameAbove:function(){const $iframe=$("iframe",window.parent.document);const our_iframe=$iframe.toArray().filter((iframe=>{if(null==iframe.contentDocument.body)return false;const $innerDocument=$(iframe.contentDocument);return!kh_js.isEmpty($innerDocument.find(this))}));return 1==our_iframe.length?$(our_iframe[0]):$()},postMessage:function(event_type,event_data,$receiver){const $iframe=this.getIFrameAbove();if(kh_js.isEmpty($iframe))return($receiver??this).post(event_type,event_data);if(!kh_js.isEmpty($receiver)){let ok=$receiver.get(0)==$iframe.get(0)||$iframe.isParent($receiver);if(!ok)return}const iframe_cw=kh_js.isEmpty($receiver)?$iframe.get(0).contentWindow:window.parent;const jq=iframe_cw.$;let request_id=getRandomArbitrary()>>>0;const key_pmh="#kh_postmsg_handler_";const key_pmm="#kh_postmsg_map_";if(!kh_js.isValid(iframe_cw[key_pmh])){iframe_cw[key_pmm]=new Map;iframe_cw[key_pmh]=function(event){const{data,origin,source}=event;const{et,ed,rid}=data;let jq_this=iframe_cw[key_pmm].get(rid);jq_this=jq(jq_this);jq_this.trigger(et,ed);iframe_cw[key_pmm].delete(rid)};iframe_cw.addEventListener("message",iframe_cw[key_pmh])}iframe_cw[key_pmm].set(request_id,$receiver??this);iframe_cw.postMessage({et:event_type,ed:event_data,rid:request_id},"*")}});jq["$$"]=iter=>[...iter].reduce(((cv,v)=>cv.add(v)),jq());jq["$r"]=selector=>{let ret=$(selector);ret.refresh=()=>$(selector);return ret};if(jq.ui){jq.ui.subClass??=function(get_main_window){jq.ui.dialog.prototype.options.open=function(event){get_main_window??=()=>jq(".kh-window-main");let css_options={width:"",height:""};if(kh_js.isMobile())css_options={...css_options,top:0,left:0};const $this=jq(this);const ui_dialog=$this.dialog("instance");ui_dialog.uiDialog.css(css_options);if(!kh_js.isMobile())$this.css({"max-height":""});if(kh_js.isMobile()){const must_hide_main_window="none"!==get_main_window()?.css("display");if(must_hide_main_window)get_main_window()?.css("display","none");const ns="kh-ui-dialog";ui_dialog.uiDialog.on(`click.${ns}`,ui_dialog.uiDialog.find(".ui-dialog-title"),(event=>{$this.dialog("close")}));ui_dialog.uiDialog.on(`dialogclose.${ns}`,(()=>{if(must_hide_main_window)get_main_window()?.css("display","");ui_dialog.uiDialog.off(`.${ns}`);defer(100).then((()=>$this.dialog("destroy")))}))}};jq.ui.dialog.prototype.options.dragStart=function(event){const dialog=jq(this).dialog("instance").uiDialog;dialog.css({"max-width":dialog.width(),"max-height":dialog.height})};jq.ui.dialog.prototype.options.dragStop=function(event){const dialog=jq(this).dialog("instance").uiDialog;dialog.css({"max-width":"","max-height":""})};jq.widget("ui.tabs",jq.ui.tabs,{_processTabs:function(){if(!kh_js.isValid(this.element.own_find_)){const f=this.element.find;const el=this.element;this.element.find=function(selector){return f.call(el,window.decodeURI(selector.replace(/\\%/g,"%")))};this.element.own_find_=true}this._super();const $all_tabs=this.tabs;$all_tabs.each(((idx,li)=>{jq(li).attr("tabindex",idx+1);jq(li).attr("aria-controls",window.decodeURI(jq(li).attr("aria-controls")))}))}})};jq.ui.mergeOptions??=function(stdOptions={},options={},opt="classes",clone=true){clone&&(stdOptions=cloneObject(stdOptions));stdOptions[opt]??={};options[opt]??={};const stdOptions_opt=stdOptions[opt];for(const k in stdOptions_opt){let v=stdOptions_opt[k];if(!kh_js.isValid(v))continue;if(!Array.isArray(v))v=[v];const options_opt=options[opt];if(kh_js.isValid(options_opt)){if(!Array.isArray(options_opt[k]))options_opt[k]=[options_opt[k]];stdOptions_opt[k]=[...new Array(options_opt[k].length),...v]}}stdOptions=kh_js.JSON8MergePatch.apply(stdOptions,options,{assign:true,array:true});for(const k in stdOptions_opt){if(Array.isArray(stdOptions_opt[k]))stdOptions_opt[k]=stdOptions_opt[k].join(" ")}return stdOptions}}return true})();export class WindowArgs{static get align(){return"align"}static get arg(){return"arg"}static get argz(){return"argz"}static get audio(){return"audio"}static get auditor(){return"auditor"}static get auto(){return"auto"}static get bgc(){return"bgc"}static get classz(){return"class"}static get command(){return"command"}static get component(){return"component"}static get content(){return"content"}static get data(){return"data"}static get db(){return"db"}static get def(){return"def"}static get disabled(){return"disabled"}static get distribute(){return"distribute"}static get draggable(){return"draggable"}static get droppable(){return"dropable"}static get each(){return"each"}static get embedded(){return"embedded"}static get entries(){return"entries"}static get event(){return"event"}static get fgc(){return"fgc"}static get font(){return"font"}static get forward(){return"forward"}static get grouping(){return"grouping"}static get header(){return"header"}static get height(){return"height"}static get horizontal(){return"horizontal"}static get html(){return"html"}static get icon(){return"icon"}static get id(){return"id"}static get iframe(){return"iframe"}static get ignore(){return"ignore"}static get image(){return"image"}static get imagemap(){return"imagemap"}static get include_url(){return"include_url"}static get key(){return"key"}static get locale(){return"locale"}static get label(){return"label"}static get label_key(){return WindowArgs.label+"_"+WindowArgs.key}static get lvc_parent(){return"lvc_"+WindowArgs.parent}static get map(){return"map"}static get menu(){return"menu"}static get message(){return"message"}static get method(){return"method"}static get mime(){return"mime"}static get mobile(){return"mobile"}static get mode(){return"mode"}static get model(){return"model"}static get multiline(){return"multiline"}static get name(){return"name"}static get _native(){return"native"}static get open(){return"open"}static get orient(){return"orient"}static get paramz(){return"paramz"}static get parent(){return"parent"}static get pdf(){return"pdf"}static get position(){return"position"}static get prompt(){return"prompt"}static get popup(){return"popup"}static get reference(){return"reference"}static get rows(){return"rows"}static get sclass(){return"sclass"}static get script(){return"script"}static get secure(){return"secure"}static get selective(){return"selective"}static get selector(){return"selector"}static get sizable(){return"sizable"}static get special(){return"special"}static get style(){return"style"}static get tc(){return"tc"}static get template(){return"template"}static get text(){return"text"}static get themer(){return"themer"}static get title(){return"title"}static get tooltip(){return"tt"}static get type(){return"type"}static get uuid(){return"uuid"}static get url(){return"url"}static get user(){return"user"}static get vertical(){return"vertical"}static get visible(){return"visible"}static get ui_model(){return"ui_model"}static get value(){return"value"}static get value_def(){return"value_def"}static get value_each(){return"value_each"}static get video(){return"video"}static get vm(){return"vm"}static get wargz(){return"wargz"}static get width(){return"width"}static get xhtml(){return"xhtml"}static get xml(){return"xml"}static get zul(){return"zul"}static data(...ss){return[WindowArgs.data,...ss].join("_")}static get uim_doc_tree(){return"uim_doc_tree"}static get uim_group_details(){return"uim_group_details"}static get uim_group_list(){return"uim_group_list"}static get uim_iframe(){return"uim_iframe"}static get uim_input(){return"uim_input"}static get uim_list(){return"uim_list"}static get uim_menu(){return"uim_menu"}static get uim_menu_item(){return"uim_menu_item"}static get uim_onto_tree(){return"uim_onto_tree"}static get uim_row(){return"uim_row"}static get uiu_disabled(){return"uiu_"+WindowArgs.disabled}static get uiu_visible(){return"uiu_"+WindowArgs.visible}static get uiu_style(){return"uiu_"+WindowArgs.style}static get uiu_type(){return"uiu_type"}static get uiu_ignore(){return"uiu_"+WindowArgs.ignore}static get evtGeoLocation(){return"onGeoLocation"}static get evtScriptLoad(){return"onScriptLoad"}static get evtScriptFail(){return"onScriptFail"}static get evtUIUpdate(){return"onUIUpdate"}static get evtSetDimension(){return"onSetDimension"}static get evtClientAttribute(){return"onClientAttribute"}static get evtClientDimension(){return"onClientDimension"}static get evtHistoryMark(){return"onHistoryMark"}}export function makeAnimationLoop(func,intervall){let last_animation=-1;intervall=false==intervall?intervall:kh_js.isNumber(intervall,true)?intervall|0:1e3;return function loop(timepoint){if(false==intervall||-1==last_animation||intervall<timepoint-last_animation){const diff_time=-1!=last_animation?timepoint-last_animation:100;const ret=func(timepoint,diff_time);if("break"===ret)return;if(false!==ret)last_animation=timepoint}return requestAnimationFrame(loop)}(kh_global.performance.now())}export function requestTick(t_u){if(!kh_js.isValid(t_u)||"function"!==typeof t_u.updater)return;if(true!=t_u.ticker)requestAnimationFrame((()=>t_u.updater(t_u)));t_u.ticker=true}export function routeClientWidth(marker,source,targets,calc){if(marker&&window.kh.storage[`resize_${marker}`]){window.kh.storage[`resize_${marker}`](null);return}const jq=kh_global.jq||kh_global.$;const doIt=deferF((function(event){let jq_source=getDOMObjectsFromStr(source);if(kh_js.isEmpty(jq_source))return;let jq_targets=getDOMObjectsFromStr(targets);if(kh_js.isEmpty(jq_targets))return;let dx=jq_source.get(0).clientWidth;dx="function"===typeof calc?calc(dx):dx;jq_targets.width(dx)}),250);window.addEventListener("resize",doIt);doIt(null);if(marker){window.kh.storage[`resize_${marker}`]=doIt;window.kh.storage[`unbind_${marker}`]=function(){window.removeEventListener("resize",doIt);window.kh.storage[`unbind_${marker}`]=undefined}}}export function directStickies(selector,attr){document.querySelectorAll(selector||".sticky")?.forEach((elem=>{elem.classList.remove("sticky");attr||="position:sticky;";elem.setAttribute("style",(elem.getAttribute(style)??"")+attr)}))}export async function downloadFile(src,mime,dest){if(undefined!==mime&&(null===mime||null!==mime&&0==mime.length))mime="none";import(`${js_prefix}/ext_download${VERSION}.js`).then((module=>module.default(src,dest,mime)))}export function minify_json(json_data,{filter_key,filter_value,as_string=true}={}){if(kh_js.isString(json_data)){try{json_data=JSON.parse(json_data)}catch(error){json_data=undefined}}if(!kh_js.isEmpty(json_data)){filter_key=!kh_js.isEmpty(filter_key)?new RegExp(filter_key):undefined;filter_value=!kh_js.isEmpty(filter_value)?new RegExp(filter_value):undefined;json_data=JSON.stringify(json_data,(function(key,value){if(true==filter_key?.test(key))return undefined;if(true==filter_value?.test(value))return undefined;return value}),0)}else json_data="{}";return as_string?json_data:JSON.parse(json_data)}Object.assign(cs,{deferF,defer,open_doc,realizeShariff,getGeoLocation,setAttribute_,directStickies,getHtml,disable_pointer,downloadFile,toKebabCase});kh_global.LoadedScripts.get(mf).resolve(ms);