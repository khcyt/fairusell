const kh_global=Function("return globalThis;")()||Function("return this;")()||Function("return self;")();const as_module=undefined==this;const asWorker="undefined"===typeof window&&"undefined"===typeof process&&self;const cf="kh_cms";const mf="kh_cms_esm";kh_global.kh??={};kh_global.kh.context??="undefined"!==typeof window?kh_global.parent==kh_global?"window":"iframe":"undefined"!==typeof process?"node.js":"undefined"!==typeof self?self.name??"worker":"unknown";kh_global.kh.storage??={};const cs=kh_global.kh.storage[cf]??={cf,ms:new Set};const ms=kh_global.kh.storage[mf]??={mf,cs};cs.ms.add(ms);import*as kh_js_e from"/contrib/jsm/kh_earlybird.js";import*as kh_js_c from"/contrib/jsm/kh_classes.js";import*as kh_js_c2 from"/contrib/jsm/kh_classes2.js";import*as kh_js_f from"/contrib/jsm/kh_functions.js";const kh_js=Object.assign({...kh_js_e},{...kh_js_c},{...kh_js_c2},{...kh_js_f});const print_level=undefined;import{Logger}from"/contrib/jsm/kh_log.js";const kh_log=new Logger(print_level,(()=>name));const name=MF`${mf}`;const spec_log=kh_js.isProduction?kh_log.debug:kh_log.info;import{vjs}from"/contrib/jsm/kh_vanilla.js";import*as vjs2 from"/contrib/jsm/kh_vanilla2.js";Object.assign(vjs,{...vjs2});cs.strings??=function(){const cms_sm=new kh_js.StringMap({"cms-blend-out":"kh-cms-blend-out","cms-event-fulfill":"fulfill","cms-event-process-tc":"processtc","cms-event-ready-tc":"readytc","cms-event-children-tc":"childrentc"});kh_js.StringMap.getGlobalMap().addEntries(cms_sm);return cms_sm}();function own_prop(o,prop){if(o?.hasOwnProperty(prop))return true;const descriptor=Object.getOwnPropertyDescriptor(o,prop)??Object.getOwnPropertyDescriptor(Object.getPrototypeOf(o),prop);if(!kh_js.isValid(descriptor))return false;return kh_js.isValid(descriptor.get)}function prepare_key(key){if(!kh_js.isValid(key))return[];return kh_js.make_unique([key,kh_js.toKebabCase(key),kh_js.toCamelCase(key)])}function get_prop(o,key,{strict=false,get_html=false}={}){get_html||=typeof HTMLElement!=="object";const keys=prepare_key(key);for(let k of keys){if(o instanceof Map){if(o.has(k))return o.get(k)}else{let has_prop=strict||kh_js.isPrimitive(o)?own_prop(o,k):k in o;if(!get_html&&kh_js.isDOMElement(o[k]))has_prop=false;return has_prop?o[k]:vjs.data(o,k)}}return undefined}function has_prop(o,key,{strict=false,get_html=false}={}){get_html||=typeof HTMLElement!=="object";const keys=prepare_key(key);for(let k of keys){if(o instanceof Map){if(o.has(k))return true}else{let has_prop=strict||kh_js.isPrimitive(o)?own_prop(o,k):k in o;if(!get_html&&kh_js.isDOMElement(o[k]))has_prop=false;return has_prop||kh_js.isValid(vjs.data(o,k))}}return false}const _onevent={direct:true,set:function(Șelem,key,value){Șelem=vjs(Șelem);if(kh_js.isEmpty(Șelem))return;if(kh_js.isValid(value)){const event_type=key.substring(2);const handler_attr_name=`handler-${event_type}`;if(kh_js.isValid(Șelem[0][handler_attr_name]))vjs.off(event_type,Șelem[0][handler_attr_name],Șelem);vjs.on(event_type,Șelem[0][handler_attr_name]=event=>{const detail=!(event instanceof MouseEvent)?event.detail:undefined;return $eval(value,event.target,event,detail)},Șelem)}}};const tcMap_={"fix-content":{select:function(Șbase,key){Șbase=vjs(Șbase);if(kh_js.isEmpty(Șbase))return[];let Șelems=vjs.contains(Șbase,"@(");Șelems=Șelems.flat().filter((elem=>"SCRIPT"!==elem.tagName));return Șelems},get:function(Șelem,key){Șelem=vjs(Șelem);if(kh_js.isEmpty(Șelem))return undefined;const textNodes=Șelem.map((elem=>[...elem.childNodes].filter((node=>"#text"===node.nodeName)))).flat();if(kh_js.isEmpty(textNodes))return undefined;return textNodes.map((node=>node.nodeValue))},filter:function(Șelem,key,value){return Array.isArray(value)&&!kh_js.isEmpty(value)&&-1!=value.findIndex((s=>!kh_js.isEmpty(s)))},map:function(Șelem,key,value){return unzipProp(value,false,Șelem)},set:function(Șelem,key,value){Șelem=vjs(Șelem);if(kh_js.isEmpty(value)||kh_js.isEmpty(Șelem))return;if(!Array.isArray(value))ȘelemforEach((elem=>elem.insertAdjacentHTML("beforeend",value)));else{const textNodes=Șelem.map((elem=>[...elem.childNodes].filter((node=>"#text"===node.nodeName)))).flat();if(kh_js.isEmpty(textNodes)||textNodes.length!=value.length)return;textNodes.forEach(((node,idx)=>{const p=document.createElement("p");p.innerHTML=value[idx];if(2>p.childNodes.length)node.data=value[idx];else node.parentNode.replaceChild(p,node)}))}}},id:{direct:true},class:{direct:true,set:(Șelem,key,value)=>{Șelem=vjs(Șelem);if(kh_js.isEmpty(Șelem))return;const classes=class_pretty(value,false);if(!kh_js.isEmpty(classes))Șelem.forEach((elem=>elem.classList.add(...classes)))}},style:{direct:true,set:function(Șelem,key,value){try{Șelem=vjs(Șelem);if(kh_js.isEmpty(Șelem))return;let new_style;try{new_style=kh_js.isValid(value)?JSON.parse(value):{}}catch(e){new_style=inlineStyle2CSS(value,false)}vjs.style(Șelem,new_style)}catch(e){kh_log?.error?.("set-style",e.toString())}}},title:{direct:true,set:function(Șelem,key,value){Șelem=vjs(Șelem);if(kh_js.isEmpty(Șelem))return;Șelem.forEach((elem=>{try{elem.setAttribute("title",value)}catch(e){kh_log?.error?.("set-title",e.toString())}}))}},fulfill:{select:(Șbase,key)=>{Șbase=vjs(Șbase);if(kh_js.isEmpty(Șbase))return[];const Șelems=[...Șbase.filter((base=>base.matches('[data-fulfill]:not([data-fulfill=""])'))),...vjs(Șbase,'[data-fulfill]:not([data-fulfill=""])',true)];return Șelems},set:(Șelem,key,value)=>{Șelem=vjs(Șelem);if(kh_js.isEmpty(Șelem))return;const event_ready_tc=unzipProp("cms-event-ready-tc");if("defer"==value||"async"==value){vjs.one(event_ready_tc,(event=>vjs.attr(Șelem,"data-fulfill",null)),window);if("defer"==value)return;if("async"==value)value=`.${event_ready_tc}`}let[id,event_type="load"]=value.split(".");let target=!kh_js.isEmpty(id)?vjs(`#${id}`,false):window;if(!kh_js.isValid(target))return;let data_attr_name=`data-${id??"window"}-${vjs.attr(Șelem[0],"id")??"elem"}-${event_type}`.replace("_","-");let handler=null;if(kh_js.isEmpty(vjs.data(target,data_attr_name))){vjs.on(event_type,handler=event=>{let do_defaults=vjs.trigger(unzipProp("cms-event-fulfill"),Șelem,event);Șelem.forEach(((elem,idx)=>{const do_default=do_defaults[idx]??do_defaults;if(do_default){elem.removeAttribute("data-fulfill");vjs.off(event_type,handler,target);vjs.data(target,data_attr_name,null);processTemplateContent(elem,null,"async")}}))},target);vjs.data(target,data_attr_name,"await")}}},"data-map":{select:function(Șbase,ds_key){Șbase=vjs(Șbase);if(kh_js.isEmpty(Șbase))return[];const tcm_keys=Object.keys(tcMap_);let Șall=[...Șbase,...vjs(Șbase,":scope *",true)];Șall=Șall.filter((dom=>{if(kh_js.isEmpty(dom.dataset))return false;let ds_keys=Object.keys(dom.dataset).map((ds_key=>{ds_key=kh_js.toKebabCase(ds_key);if(ds_key.endsWith("-data"))ds_key=ds_key.substring(0,ds_key.length-5);return ds_key}));for(ds_key of ds_keys)if(-1==tcm_keys.indexOf(ds_key))return true;return false}));return Șall},get:function(Șelem,key){return 1},set:function(Șelem,key,value){Șelem=vjs(Șelem);if(kh_js.isEmpty(Șelem))return;const dom=Șelem[0];Șelem=undefined;if(kh_js.isEmpty(dom.dataset))return false;let tcm_keys=Object.keys(tcMap_);kh_js.for_in(dom.dataset,(ds_key=>{let dsk=kh_js.toKebabCase(ds_key);if(dsk.endsWith("-data"))dsk=dsk.slice(0,-5);if(-1==tcm_keys.indexOf(dsk)){let unzipped=unzipProp(vjs.data(dom,`${ds_key}-ori`)??dom.dataset[ds_key],false,dom);if(undefined==vjs.data(dom,`${ds_key}-ori`))vjs.data(dom,`${ds_key}-ori`,dom.dataset[ds_key]);if(kh_js.isValid(unzipped)){let default_handling=false;switch(dsk){case"argz":{dom.dataset[ds_key]="@(attribute(self, 'argz', true))";vjs.data(dom,"argz",unzipped);break}case"readonly":{if(false===kh_js.string2bool(unzipped))vjs.attr(dom,ds_key,null);else vjs.attr(dom,ds_key,"readonly");break}case"min":case"max":case"name":case"type":case"checked":case"list":case"list":case"selected-index":case"value":{if("INPUT"===dom.tagName){if("checked"==ds_key){dom.checked=kh_js.string2bool(unzipped)}else{vjs.attr(dom,ds_key,unzipped)}vjs.data(dom,"kh-cms-processed").add(ds_key);break}else if("SELECT"===dom.tagName||"DATALIST"==dom.tagName){if(("value"==ds_key||"list"==ds_key)&&!vjs.data(dom,"kh-cms-processed").has(ds_key)){try{unzipped=JSON.parse(unzipped)}catch(e){}unzipped=kh_js.isString(unzipped)?[unzipped]:Array.isArray(unzipped)?unzipped:[unzipProp("@(invalid-argument)")];dom.append(...unzipped.map((s_entry=>{let lvc=LVC.tryLVC(s_entry);let label=lvc instanceof LVC?lvc.label:s_entry.toString();let value=lvc instanceof LVC?lvc.value:s_entry;let title=lvc instanceof LVC?lvc.getAttribute(kh_js.WindowArgs.tooltip):undefined;const option=vjs.create("option",{title:title??"",value:kh_js.isString(value)?value:JSON.stringify(value),text:label});return option}))??[]);vjs.data(dom,"kh-cms-processed").add(ds_key)}else if("selectedIndex"==ds_key){dom[ds_key]=unzipped}break}default_handling=true;break}case"alt":case"src":{if("IMG"===dom.tagName){vjs.attr(dom,ds_key,unzipped);break}default_handling=true;break}case"for":{if("LABEL"===dom.tagName){vjs.attr(dom,ds_key,unzipped);break}default_handling=true;break}case"target":case"href":{if("A"===dom.tagName){vjs.attr(dom,ds_key,unzipped);break}default_handling=true;break}case"placeholder":{if("INPUT"===dom.tagName){vjs.attr(dom,ds_key,unzipped);break}default_handling=true;break}case"aria-keyshortcuts":case"aria-disabled":case"aria-labelledby":case"aria-activedescendant":case"aria-selected":{vjs.attr(dom,dsk,unzipped);break}case"eval-context":break;default:{default_handling=true;break}}if(default_handling){if(!kh_js.isjQuery(unzipped)&&!kh_js.isDOMNode(unzipped)){let s_unzipped=unzipped;if(!kh_js.isString(s_unzipped)){switch(dsk){case"each":case"value-each":if(kh_js.isDevelopement)s_unzipped=JSON.stringify(reduce(unzipped));else s_unzipped=`@(${ds_key})`;break;default:s_unzipped=JSON.stringify(unzipped);break}}dom.dataset[ds_key]=s_unzipped}vjs.data(dom,ds_key,unzipped)}}}}))}},"set-class":{set:(Șelem,key,value)=>{Șelem=vjs(Șelem);if(kh_js.isEmpty(Șelem))return;vjs.attr(Șelem,"class",null);const classes=class_pretty(value,false);if(!kh_js.isEmpty(classes))Șelem.forEach((elem=>elem.classList.add(...classes)))}},content:{get:function(Șelem,key){Șelem=vjs(Șelem);if(kh_js.isEmpty(Șelem))return;const elem=Șelem[0];Șelem=undefined;const value=elem.getAttribute(`data-${key}`)?.trim()||vjs.data(elem,key);return value},set:function(Șelem,key,value,Șbase){Șelem=vjs(Șelem);if(kh_js.isEmpty(Șelem))return;const elem=Șelem[0];Șelem=undefined;vjs.empty(elem);vjs.data(elem,"kh-cms-processed").delete("content");try{if(kh_js.isString(value))value=JSON.parse(value)}catch(e){}let content_as_array=Array.isArray(value)?value:[value];let previous=undefined;content_as_array.map(((caa,child_idx)=>{let forEachStatus={index:child_idx,values:content_as_array,previous,toJSON:function(){return kh_js.Class.toJSON(this,["index",{key:"values",converter:arr=>`[n= ${arr.length}]`}])}};if(previous)previous.next=forEachStatus;if(kh_js.isDOMElement(caa)){elem.insertAdjacentElement("beforeend",caa)}else if(kh_js.isString(caa)){elem.insertAdjacentHTML("beforeend",caa)}else if(caa){let ui_model=(caa.ui_model??get_prop(caa.attributes,"ui_model"))||"text";ui_model=unzipProp(ui_model,false,elem);let new_nodes=undefined;switch(ui_model){case"table":createRows(elem);new_nodes=elem.children;break;default:{new_nodes=vjs.NodeFromTemplate(ui_model);if(!Array.isArray(new_nodes))new_nodes=[new_nodes];new_nodes.forEach((node=>{vjs.data(node,"each",caa);vjs.data(node,"forEachStatus",forEachStatus)}));elem.append(...new_nodes);vjs.attr(new_nodes,"data-fulfill","defer");break}}}previous=forEachStatus}));if(!kh_js.isEmpty(elem.children)){const cms_event_ready_tc=unzipProp("cms-event-ready-tc");vjs.onoff(cms_event_ready_tc,((event,my_elem_test)=>{if(my_elem_test(event))vjs.postEvent(unzipProp("cms-event-children-tc"),window,{node:elem,key})}),window,(event=>{const childs_1=vjs(event.detail?.node);const childs_2=vjs(elem.children);return childs_1?.equals(childs_2)}));vjs.one(cms_event_ready_tc,(event=>{vjs.attr(elem.children,"data-fulfill",null);processTemplateContent(elem.children,null,"async").then((()=>{let id_setter=idSetter();vjs(elem,"*",true).forEach(id_setter);vjs.data(elem,"kh-cms-processed").add("content")}))}),window)}}},create:{opt:function(Șelem,key){Șelem=vjs(Șelem);if(kh_js.isEmpty(Șelem))return;const elem=Șelem[0];Șelem=undefined;return vjs.data(elem,"create-data")},filter:function(Șelem,key,value){Șelem=vjs(Șelem);if(kh_js.isEmpty(Șelem))return;const elem=Șelem[0];Șelem=undefined;return!kh_js.isEmpty(value)&&!vjs.data(elem,"kh-cms-processed").has("create")},set:function(Șelem,key,value){Șelem=vjs(Șelem);if(kh_js.isEmpty(Șelem))return;const elem=Șelem[0];Șelem=undefined;if(kh_js.isValid(value)){vjs.data(elem,"kh-cms-processed").add("create");const children_exists=!kh_js.isEmpty(elem.children);processTemplateContent((()=>elem.children),null,children_exists?"async":100)}}},load:{opt:function(Șelem,key){Șelem=vjs(Șelem);if(kh_js.isEmpty(Șelem))return;const elem=Șelem[0];Șelem=undefined;return vjs.data(elem,"load-data")},set:function(Șelem,key,value){Șelem=vjs(Șelem);if(kh_js.isEmpty(Șelem))return;const elem=Șelem[0];Șelem=undefined;if("global"==vjs.data(elem,"load-data"))return kh_js.loadScript(value).then((()=>vjs.trigger("load",elem,{src:value})));vjs.empty(elem);if(kh_js.isValid(value)){processTemplateContent(elem,"register");let fragment;[value,fragment]=value.split("#");const dompurify_p=kh_js.isValid(kh_global.DOMPurify)?Promise.resolve({default:kh_global.DOMPurify}):kh_js.loadModule("/cdn/dompurify/+esm",undefined,3e3);import("/contrib/jsm/kh_io.js").then((kh_io=>Promise.allSettled([kh_io.Util.fetchData(undefined,value),dompurify_p]))).then((async([v_content,v_purify])=>{if("fulfilled"==v_purify.status)kh_global.DOMPurify=v_purify.value.default;else kh_global.DOMPurify={};if("fulfilled"!=v_content.status)throw v_content.reason;return kh_global.DOMPurify.sanitize?.(v_content.value,{USE_PROFILES:{html:true},ADD_TAGS:["script","object"],ADD_ATTR:["data","onclick"]})??v_content.value})).then((content=>{if(!kh_js.isEmpty(fragment)){const html=document.createElement("html");vjs.insertAdjacentHTML(html,"beforeend",content);content=vjs(html,`#${fragment}`,false);elem.append(content)}else vjs.insertAdjacentHTML(elem,"beforeend",content)})).catch((error=>kh_log.error?.(T9`error during process data-load(${value}) => ${error}`))).finally((()=>{let id=elem.getAttribute("id");if(kh_js.isEmpty(id))elem.setAttribute("id",id=genUUID());processTemplateContent(elem.children).then((()=>{vjs.data(vjs.html,"watcher")?.(elem)}))}))}}},for:{direct:true},onblur:_onevent,onchange:_onevent,onclick:_onevent,onactivate:_onevent,onfulfill:_onevent,oninput:_onevent,__nop:0};export let genUUID=()=>uuid();export function idSetter(ignore_tags_id=["br","b","del","ins","q","s","u"],uuid_gen=genUUID){return(idx,node)=>{if(kh_js.isDOMNode(idx))node=idx;return!ignore_tags_id.includes(node.tagName.toLowerCase())&&kh_js.isEmpty(node.getAttribute("id"))?(node.setAttribute("id",uuid_gen()),true):undefined}}const switchNodes=new Set;export const registeredMainwindows=function(){ms.mainWindows??=[];return()=>ms.mainWindows}();export async function setMainWindow(mainWindow,eval_context,ignore_tags_id=["br","b","del","ins","q","s","u"]){const ȘmainWindow=vjs(mainWindow);if(kh_js.isEmpty(ȘmainWindow))return false;registeredMainwindows().push(...ȘmainWindow);let id_setter=idSetter(ignore_tags_id);vjs(ȘmainWindow,"*",true)?.forEach(id_setter);vjs.on(unzipProp("vjs-switch-flag",true),(event=>{processTemplateContent([...switchNodes],null,"async")}),window);let ec=[cs,kh_global,kh_global.kh.storage];ec=Array.isArray(eval_context)?[...ec,...eval_context]:kh_js.isObject(eval_context)?[...ec,eval_context]:ec;vjs.data(ȘmainWindow,"eval-context",ec);let ecn=[cf,"global","kh"];ecn=Array.isArray(eval_context)?[...ecn,...eval_context.map((_ec=>_ec.name||_ec.cf||_ec.mf||"N.N."))]:kh_js.isObject(eval_context)?[...ecn,eval_context.name||eval_context.cf||eval_context.mf]:ecn;ȘmainWindow.forEach((mw=>mw.setAttribute("data-eval-context",JSON.stringify(ecn))));const Șbase_node_autoid=[vjs.html];registerNodesWithMutationObserver(Șbase_node_autoid,(mutation=>{kh_log?.trace?.("mutation",mutation.type,"found");return"childList"===mutation.type&&0!=mutation.addedNodes.length?[...mutation.addedNodes.values()].filter(kh_js.isDOMElement):false}),((selector,data,was_base_node)=>{try{if(-1!=Șbase_node_autoid.indexOf(was_base_node)){let id_setter_2=node=>was_base_node.contains(node)?id_setter(node):undefined;vjs(selector)?.forEach(id_setter_2);vjs(selector,"*",true)?.forEach(id_setter_2)}return undefined}catch(error){kh_log.error?.(T9`error during execution mutation callback for childList => ${error}`)}}),{childList:true,subtree:true},undefined);const first=true!==cs["set-main-window-called"];if(first){cs["set-main-window-called"]=true;vjs.on(unzipProp("cms-event-process-tc"),(event=>processTemplateContent(event.detail?.node,event.detail?.key_list)),window)}return processTemplateContent(first?vjs.body:ȘmainWindow)}const deferPromise4PTC=new Map;export function processTemplateContent(base,key_list=undefined,defer){return new Promise((function(resolve,reject){let Șbase=base||vjs.body;if(!Array.isArray(Șbase)&&"function"!=typeof Șbase)Șbase=vjs(Șbase);if(!kh_js.isValid(Șbase)){return}let one_of_my_parents="function"!=typeof Șbase?[...deferPromise4PTC.keys()].find((map_key=>Șbase.equals(map_key)||vjs.isParent(Șbase,map_key,true))):undefined;if(!kh_js.isValid(one_of_my_parents)){one_of_my_parents=Șbase;if(!deferPromise4PTC.has(one_of_my_parents))deferPromise4PTC.set(one_of_my_parents,{promise:new kh_js.Deferred,waiting:new Set,origin:Șbase})}const map_entry=deferPromise4PTC.get(one_of_my_parents);map_entry.waiting.add(Șbase);const promise=map_entry.promise;promise.then((async res=>resolve(res))).catch((error=>reject(error)));let allow_non_dom=false;if("async"===defer){vjs.postEvent(unzipProp("cms-event-process-tc"),window,{node:Șbase,key_list});return promise}else if("register"===defer){return promise}else if("force"===defer){allow_non_dom=true;defer=undefined}else if(!Number.isNaN(defer=Number.parseInt(defer))){window.setTimeout((()=>processTemplateContent(Șbase,key_list)),defer);return promise}let all_keys=Object.keys(tcMap_);let fulfill_idx=all_keys.indexOf("fulfill");let keys2pass=[...Array(fulfill_idx)].map(((val,idx)=>all_keys[idx]));let Șbase_from_func;if("function"===typeof Șbase){Șbase_from_func=Șbase;Șbase=Șbase();if("function"==typeof Șbase)throw new kh_js.Error("param-invalid");Șbase=vjs(Șbase)||[];let one_of_my_parents_new=[...deferPromise4PTC].find((map_key=>vjs.isParent(Șbase,map_key,true)));const map_entry_new=kh_js.isValid(one_of_my_parents_new)?deferPromise4PTC.get(one_of_my_parents_new):undefined;if(kh_js.isValid(map_entry_new))map_entry_new.promise.then((async res=>promise.resolve(res)))}const Șbase_mem=Șbase;if(!allow_non_dom){Șbase=Șbase?.filter((node=>document.documentElement.contains(node)))}kh_js.for_in(tcMap_,(function(key,value){if(!key||!value||kh_js.isEmpty(Șbase))return;if("function"==typeof value){value(Șbase,key)}else{let has_trigger="function"===typeof value["trigger"];let process=!has_trigger?kh_js.isEmpty(key_list)||Array.isArray(key_list)&&-1!=key_list.indexOf(key):value["trigger"](key,key_list);if(!process)return;let Șelems;if(value["select"])Șelems=value["select"](Șbase,key);else{if(true===value["direct"]||"function"===typeof value["direct"]&&true==value["direct"](Șbase,key)){Șelems=Șbase.filter((node=>node.matches(`*[${key}^="@("]`)));Șelems.push(...vjs(Șbase,`*[${key}^="@("]`,true)||[]);Șelems.forEach((elem=>{if(-1!=[kh_js.WindowArgs.classz,kh_js.WindowArgs.style].indexOf(key)){let data_attr_val=elem.getAttribute(`data-${key}`);if(!kh_js.isEmpty(data_attr_val)){let attr_val=unzipProp(elem.getAttribute(key),false,elem);elem.removeAttribute(key);elem.setAttribute(`data-${key}`,`@(class_concat(${class_concat(attr_val)}, ${data_attr_val}))`);return}}elem.setAttribute(`data-${key}`,elem.getAttribute(key));elem.removeAttribute(key)}));Șelems=null}Șelems=Șbase.filter((node=>node.matches(`*[data-${key}]`)));Șelems.push(...vjs(Șbase,`*[data-${key}]`,true)||[])}if(!kh_js.isEmpty(Șelems))Șelems.forEach((function(elem){if(!kh_js.isValid(elem))debugger;if(!kh_js.isValid(elem?.parentNode))return;if(undefined==vjs.data(elem,"kh-cms-processed"))vjs.data(elem,"kh-cms-processed",new Set);if(-1==keys2pass.indexOf(key)){const start_node="fulfill"==key?elem.parentNode:elem;let sop_with_fulfill=start_node.closest('[data-fulfill]:not([data-fulfill=""])');if(kh_js.isValid(sop_with_fulfill))return undefined}let attr_value=value["get"]?value["get"](elem,key):elem.getAttribute("data-"+key);let opt_value=value["opt"]?value["opt"](elem,key):undefined;if(kh_js.isString(opt_value)){opt_value=unzipProp(opt_value,false,elem);if(kh_js.isString(opt_value)){try{opt_value=JSON.parse(opt_value)}catch(error){}}}if(kh_js.isValid(opt_value))vjs.data(elem,"kh-cms-opt",opt_value);let process=value["filter"]?value["filter"](elem,key,attr_value):true;if(process){if("fix-content"==key&&-1!==(attr_value?.indexOf?.("condition")??-1))debugger;let res_value=value["map"]?value["map"](elem,key,attr_value):unzipProp(attr_value,false,elem);if(kh_js.isValid(res_value))value["set"]?value["set"](elem,key,res_value,Șbase):elem.setAttribute(key,res_value);else{spec_log?.(T9`############## invalid resolved ${attr_value}@${key}||`+T9`${elem.getAttribute("id")??unzipProp(elem.getAttribute("data-id"),false,elem)??`"${elem.tagName}.${elem.classList??"???"}"`??elem}`)}}else{}}))}}));Șbase=Șbase_mem;kh_global.setTimeout((()=>{if(!allow_non_dom){for(let entry of map_entry.waiting){const entry_key=entry;if("function"!==typeof entry_key&&entry_key!=Șbase){const entry_key_filtered=entry_key.filter((node=>document.documentElement.contains(node)));if(kh_js.isEmpty(entry_key_filtered))map_entry.waiting.delete(entry_key)}}}map_entry.waiting.delete(Șbase_from_func??Șbase);if(0==map_entry.waiting.size){promise.resolve(map_entry.origin);deferPromise4PTC.delete(map_entry.origin)}}),100);vjs.postEvent(unzipProp("cms-event-ready-tc"),window,{node:Șbase,key_list});return promise}))}export const keyWordsResolver=function(){const light_resolver=function(element,property,recurse){if(kh_js.isjQuery(element))debugger;if(!kh_js.isValid(element))return undefined;const val=get_prop(element,property,{strict:true});return val??(recurse?light_resolver(element.parentNode,property,recurse):undefined)};const keyWordsResolverMap=new Map;keyWordsResolverMap.set("undefined",(element=>undefined));keyWordsResolverMap.set("null",(element=>null));keyWordsResolverMap.set("each",(element=>light_resolver(element,"each",true)));keyWordsResolverMap.set("!each",(element=>light_resolver(element,"each",false)));keyWordsResolverMap.set("forEachStatus",(element=>light_resolver(element,"forEachStatus",true)));keyWordsResolverMap.set("!forEachStatus",(element=>light_resolver(element,"forEachStatus",false)));keyWordsResolverMap.set("attributes",(element=>element?.dataset??element?.attributes));keyWordsResolverMap.set("$attributes",(element=>element?.attributes));keyWordsResolverMap.set("this",(element=>element));keyWordsResolverMap.set("self",(element=>element));keyWordsResolverMap.set("parent",(element=>element?.parentNode));keyWordsResolverMap.set("class",(element=>light_resolver(element,"class",false)??element?.className));keyWordsResolverMap.set("style",(element=>light_resolver(element,"style",false)??element?.getAttribute?.("style")));keyWordsResolverMap.set("kh_cms",(element=>cs));keyWordsResolverMap.set("kh_js",(element=>kh_js));keyWordsResolverMap.set("previousSibling",(element=>element.previousElementSibling??element.previous));keyWordsResolverMap.set("previousSiblingAll",(element=>element?.previousSibling));keyWordsResolverMap.set("nextSibling",(element=>element.nextElementSibling??element.next));keyWordsResolverMap.set("nextSiblingAll",(element=>element?.nextElementSibling));return keyWordsResolverMap}();function rebind_keyWordsResolver(start_element,level){let eval_context=[];if(0==level&&(kh_js.isjQuery(start_element)||kh_js.isDOMElement(start_element))){const one_start_element=vjs(start_element)?.[0];let mw_with_ec=one_start_element?.closest("[data-eval-context]");if(kh_js.isEmpty(mw_with_ec))mw_with_ec=vjs(vjs.body,"[data-eval-context]",false);eval_context=[...vjs.data(mw_with_ec,"eval-context")]}if(0==level&&kh_js.isValid(start_element)&&kh_js.isEmpty(eval_context))eval_context=[cs,kh_global,kh_global.kh.storage];const primitive=obj=>obj instanceof Map||kh_js.isPlainObject(obj);const to_front=primitive(start_element)||Array.isArray(start_element)&&start_element.every(primitive);const start_element_as_array=kh_js.isjQuery(start_element)?start_element.toArray():[start_element];to_front?eval_context.unshift(...start_element_as_array):eval_context.push(...start_element_as_array);return{has(key){if(!kh_js.isValid(key))return false;if(keyWordsResolver.has(key))return true;return-1!=eval_context.findIndex((ec=>{if(ec instanceof Map)return ec.has(key);if(has_prop(ec,key,{strict:true}))return true;if(!kh_js.isPrimitive(ec)){if(!kh_js.isEmpty(key)){if(`${key}_`in ec)return true;if(!key.startsWith("on")){if(`on${key}`in ec)return true;if(`on${key.at(0).toUpperCase()}${key.substring(1)}`in ec)return true}}}if(kh_js.isDOMElement(ec)){if(key.startsWith("data")){const sub_key=key.substring("-"==key.at(4)?5:4);if(kh_js.isValid(vjs.data(ec,sub_key)??vjs.data(ec,kh_js.toCamelCase(sub_key))))return true}if(kh_js.isValid(ec.getAttribute(key)??ec.getAttribute(kh_js.toKebabCase(key))))return true}return false}))},_getSafeFunc(context,key,val){val??=context[key];if("function"==typeof val){return{ori_func:val,func:val.bind(context),context,is_function:true,is_eval_func:"$eval"==val.name||kh_global.eval==val||$eval==val,is_attribute_func:attribute==val||argz==val||sub_argz==val}}return val},get(key){if(!kh_js.isValid(key))return undefined;if(keyWordsResolver.has(key))return keyWordsResolver.get(key);const ret=eval_context.reduce(((pV,ec)=>{if(kh_js.isValid(pV))return pV;if(ec instanceof Map)return ec.get(key);if(has_prop(ec,key,{strict:true}))return this._getSafeFunc(ec,key,get_prop(ec,key,{strict:true}));if(!kh_js.isPrimitive(ec)){if(!kh_js.isEmpty(key)){if(`${key}_`in ec)return this._getSafeFunc(ec,`${key}_`);if(!key.startsWith("on")){let on_key=`on${key}`;if(on_key in ec)return this._getSafeFunc(ec,on_key);on_key=`on${key.at(0).toUpperCase()}${key.substring(1)}`;if(on_key in ec)return this._getSafeFunc(ec,on_key)}}}if(kh_js.isDOMElement(ec)){if(key.startsWith("data")&&kh_js.isDOMElement(ec)){const sub_key=key.substring("-"==key.at(4)?5:4);const val=vjs.data(ec,sub_key)??vjs.data(ec,kh_js.toCamelCase(sub_key));if(kh_js.isValid(val))return val}const val=ec.getAttribute(key)??ec.getAttribute(kh_js.toKebabCase(key));if(kh_js.isValid(val))return val}return undefined}),undefined);return kh_js.isValid(ret)?()=>ret:ret}}}function isQuoted(s,allowed_quotes=['"',"'","`"]){if(!kh_js.isString(s))return false;if(2>s.length)return false;if(kh_js.isString(allowed_quotes))allowed_quotes=allowed_quotes.split("");const ch=s[0];return-1!=allowed_quotes.indexOf(ch)&&s.at(-1)==ch}export function resolveVar(s,element,eat_whitespace=true){if(!s)return s;if(s.startsWith("--")){let value=css(s);if(kh_js.isValid(s))return value}if(s.startsWith("Șeval"))return s.substring(1);let idx_rb_open=s.indexOf("(");let parameter_list;let remain_s;if(-1!=idx_rb_open){let t=evaluator(s,idx_rb_open+1,")",true,element,eat_whitespace);if(t?.["found-end-token"]){parameter_list=t.string;remain_s=s.substring(t["next-pos"]);s=s.substring(0,idx_rb_open)}}if(-1==idx_rb_open){let res=kh_js.StringMap.getGlobalMap()[s];if(kh_js.isValid(res))return res}const s_p=s.split(".");let res=element;for(let i=0;i<s_p.length;++i){const curKeyWordsResolver=rebind_keyWordsResolver(res,i);if(curKeyWordsResolver.has(s_p[i])){res=curKeyWordsResolver.get(s_p[i])?.(res);if(true==res?.is_function&&s_p.length-1!=i){kh_log.warn?.(T9`possible error in evaluation string; function call before arrived last substring => [${i}]@(${s})`)}}else{res=undefined}if(!kh_js.isValid(res))break}if(!kh_js.isValid(res))return-1!=idx_rb_open?kh_js.StringMap.getGlobalMap()[s]:undefined;if(-1!=idx_rb_open||true===res.is_function||"function"===typeof res){if(true!==res.is_function&&"function"!=typeof res){try{return`${JSON.stringify(res)}(${parameter_list??""})${remain_s??""}`}catch(error){kh_log.error?.(T9`error in ${kh_js.currentFunctionName()} => ${error}`);debugger}}else{const func_obj_before_bound=res.ori_func??res;const func_obj=res.func??res.bind(this);if(0==(parameter_list?.length??0))return func_obj(element,{empty_list:true});else{const is_eval_func=res.is_eval_func??("$eval"==func_obj_before_bound.name||eval==func_obj_before_bound);const is_attribute_func=res.is_attribute_func??(attribute==func_obj_before_bound||argz==func_obj_before_bound||sub_argz==func_obj_before_bound);let args;if(is_eval_func)args=[parameter_list];else if(-1=="({[".indexOf(parameter_list.charAt(0))){args=[];let pos=0;while(true){const t=evaluator(parameter_list,pos,",\0",true,element,eat_whitespace,["`",'"',"'"]);const arg=t?.string?.trim();args.push(arg);if(!t?.["found-end-token"])break;pos=t["next-pos"]}const last_valid_index=args.findLastIndex(kh_js.not(kh_js.isEmpty));args=-1==last_valid_index?[]:last_valid_index==args.length?args:args.slice(0,last_valid_index+1)}else{const parameter_list2=`[${parameter_list}]`;try{args=JSON.parse(parameter_list2)}catch(error){args=[parameter_list]}}if(!is_eval_func){args=args.map(((v,idx)=>{v=kh_js.isString(v)?v.trim():v;if(kh_js.isEmpty(v))return v;let vv=kh_js.isString(v)&&!isQuoted(v)?resolveVar(v,element,eat_whitespace):undefined;if(kh_js.isValid(vv))return vv;try{vv=JSON.parse(v)}catch(e){try{vv=eval(v)}catch(e){spec_log?.(T9`probably ignorable evaluation error => ${e.toString()} during eval(${v}), context @${vjs.attr(element,"id")??element}`)}}return vv?.string||vv||("undefined"===v?undefined:"null"===v?null:v)}))}if(is_eval_func)args=[...args,element];try{let res=func_obj(...args);return!kh_js.isEmpty(remain_s)?resolveVar(remain_s,res):res}catch(error){kh_log.error?.(T9`error during function call ${func_obj}() in ${kh_js.currentFunctionName()}, error= ${error}`);throw error}}}}else return res}export function evaluator(line,pos,end_tokens,must_parenthetic,element,eat_whitespace=true,string_signs=['"',"'"]){let start_pos=pos;let ok=kh_js.isValid(line)&&0<=pos;if(!ok)return undefined;let line_was_object;if(!kh_js.isString(line)){line_was_object=line;if(!kh_js.isPromise(line)){try{line=kh_js.prettyPrint2(line_was_object)}catch(error){kh_log?.warn?.(T9`Konvertierungsfehler ${error}\nbei Konvertierung von ${kh_js.getTypeName(line)} | ${line}`)}}}if(end_tokens&&!kh_js.isString(end_tokens)){kh_log?.error?.(kh_js.StringMap.getGlobalMap()["unknown-type-for"],end_tokens)}let s="";while(true){let ch=undefined;let found_whitespace=false;while(true){if(!kh_js.isString(line)||line.length<=pos){if(!kh_js.isEmpty(end_tokens)){if(-1==end_tokens.indexOf("\0")||!kh_js.isString(line)||line.length>pos){kh_log?.warn?.(T9`${kh_js.StringMap.getGlobalMap()["missing-token"]} [${end_tokens}] / ${line.substring(start_pos)}`)}}return{string:(kh_js.isPromise(line_was_object)?"":line_was_object)??(eat_whitespace?s?.trim():s),"found-end-token":false,"next-pos":pos,"was-start-pos":start_pos,convertible:!kh_js.isString(line)?false:undefined,"eat-whitespace":eat_whitespace}}ch=line.charAt(pos);if("⮑"==ch){eat_whitespace=false;pos+=1}else if("⮐"==ch){eat_whitespace=true;pos+=1}else if(!eat_whitespace||/[^\s]/.test(ch))break;else{found_whitespace=true;pos+=1}}if(found_whitespace)s+=" ";if(-1!=(!kh_js.isEmpty(end_tokens)?end_tokens.indexOf(ch):-1)){let ofs=" "===ch||":"===ch?0:1;return{string:(kh_js.isPromise(line_was_object)?"":line_was_object)??(eat_whitespace?s?.trim():s),"found-end-token":true,"next-pos":pos+ofs,"was-start-pos":start_pos,"eat-whitespace":eat_whitespace}}if("@"===ch&&(!must_parenthetic||pos<line.length-1&&"("==line.charAt(pos+1))){let is_parenthetic=pos<line.length-1&&"("==line.charAt(pos+1);let t=is_parenthetic?evaluator(line,pos+2,")",must_parenthetic,element,eat_whitespace):evaluator(line,pos+1,"; :",must_parenthetic,element,eat_whitespace);eat_whitespace=t["eat-whitespace"]??eat_whitespace;if(is_parenthetic){try{let cc=kh_js.isString(t.string)?t.string.charAt(0):"";if(('"'===cc||"'"==cc)&&2<=t.string.length&&cc===t.string.charAt(t.string.length-1)){t.string=t.string.substring(1,t.string.length-1)}}catch(error){kh_log?.warn?.(T9`°0 check this error => ${error} ${kh_js.StringMap.getGlobalMap()["during-evaluation"]} @line(${line}) @pos(${pos+1+is_parenthetic})`);return{string:undefined,"found-end-token":false,"next-pos":line.length,"was-start-pos":start_pos,"eat-whitespace":eat_whitespace}}}start_pos=pos;pos=t["next-pos"];if(!kh_js.isEmpty(t.string)){if(t["found-end-token"]||!is_parenthetic&&line.length<=pos){let resolved=resolveVar(t.string,element,eat_whitespace);if(kh_js.isPromise(resolved));if(!kh_js.isValid(resolved)){let subsub=line.substring(start_pos,pos);const rex=/^@\((['"])[^@\(\)]*\1\)$/;if(subsub.match(rex)){resolved=t.string}else spec_log?.(T9`°1 [${resolved}] ${kh_js.StringMap.getGlobalMap()["resolved-for"]} ${reduce(t.string,-40)} ${vjs.attr(element,"id")??element}`)}if(kh_js.isEmpty(s)&&line.length===pos&&!kh_js.isString(resolved)){return{string:resolved,"found-end-token":true,"next-pos":pos+(line.length===pos?0:1),"was-start-pos":start_pos,"eat-whitespace":eat_whitespace}}if(!kh_js.isValid(resolved)){s+=resolved}else{let eval_t=evaluator(resolved,0,null,must_parenthetic,element,eat_whitespace);if(!kh_js.isValid(eval_t)){spec_log?.(T9`°2[${eval_t}] ${kh_js.StringMap.getGlobalMap()["resolved-for"]} ${reduce(resolved,-40)} ${vjs.attr(element,"id")??element}`);return eval_t}eat_whitespace=eval_t["eat-whitespace"]??eat_whitespace;if(kh_js.isEmpty(s)&&(line.length==pos||false==eval_t.convertible)&&!kh_js.isString(eval_t.string)){return{string:eval_t.string,"found-end-token":true,"next-pos":pos+(line.length===pos?0:1),"was-start-pos":start_pos,"eat-whitespace":eat_whitespace}}else s+=kh_js.isString(eval_t.string)?eval_t.string:JSON.stringify(eval_t.string)}}else s+=(is_parenthetic?"@(":"@")+t.string}}else if("("===ch){try{let t=evaluator(line,pos+1,")",must_parenthetic,element,eat_whitespace);({"next-pos":pos,"eat-whitespace":eat_whitespace}=t);s+="("+t.string+(t["found-end-token"]?")":"")}catch(e){kh_log?.warn?.(T9`°3' ${e} ${line.substring([pos+1])} / (${line,pos+1})`);s+=ch;pos=pos+1}}else if("\\"==ch){if(++pos<line.length){s+=line[pos];++pos}}else if(-1!=string_signs.indexOf(ch)){try{let search_token=ch;let t=evaluator(line,pos+1,search_token,must_parenthetic,element,eat_whitespace);({"next-pos":pos,"eat-whitespace":eat_whitespace}=t);s+=search_token+t.string+(t["found-end-token"]?search_token:"")}catch(e){kh_log?.warn?.("°4",e,line.substring([pos+1]),ch,line,pos+1,")");s+=ch;pos=pos+1}}else{s+=ch;++pos}}}export function unzipProp(label_key,must_key,element,do_not_trim=false){if("function"===typeof label_key)label_key=label_key();if(!label_key)return label_key;if(kh_js.isString(label_key)&&!do_not_trim)label_key=label_key.trim();must_key=kh_js.isValid(must_key)?must_key:true;if(must_key&&0==label_key.search(/@\(/)){let respect_quotes=0==label_key.search(/@\('/)||0==label_key.search(/@\("/)?1:0;label_key=label_key.substring(2+respect_quotes,label_key.length-1-respect_quotes)}if(Array.isArray(label_key)){return label_key.map((s=>{if(!do_not_trim&&kh_js.isString(s))s=s.trim();return kh_js.isEmpty(s)?s:unzipProp(s,must_key,element)}))}let s=kh_js.StringMap.getGlobalMap()[label_key];if(!kh_js.isValid(s)){if(must_key)return s;else s=label_key}if(Array.isArray(s)){s=s.map(((cV,idx)=>unzipProp(cV,false,element)))}else{if(kh_js.isObject(s)&&!kh_js.isString(s))return s;let resolved=evaluator(s,0,null,true,element);if(kh_js.isValid(resolved))s=resolved.string}return s}export function mergeData(target,source){return Object.assign(target??{},source??{})}export function calcColWidth(element){try{element=vjs(element);if(kh_js.isEmpty(element))throw new kh_js.Error("invalid-argument");element=element[0];let table_row=element.parentNode;if(!kh_js.isValid(table_row))throw new kh_js.Error("Invalid DOM structure");let table=table_row.parentNode;if(!kh_js.isValid(table))throw new kh_js.Error("Invalid DOM structure");let widths_from_row=true;let widths=vjs.data(table_row,"widths");if(kh_js.isEmpty(widths)){widths=vjs.data(table,"widths");widths_from_row=false}if(kh_js.isString(widths)){if("skip"==widths)return"";widths=!kh_js.isEmpty(widths)?JSON.parse(widths):undefined}if(!kh_js.isValid(widths))widths=[1];else if(!Array.isArray(widths))widths=[widths];let n_cols=vjs.data(table,"ncols");if(widths_from_row||!n_cols){let siblings_and_element=vjs(table_row.children);if(kh_js.isEmpty(siblings_and_element))throw new kh_js.Error("Invalid DOM structure");n_cols=siblings_and_element.length}if(1==widths.length)return"flex-basis:"+100/n_cols+"%;";else{let sum_widths=widths.reduce((function(a,b){return a+b}),0);sum_widths+=n_cols-widths.length;const visible_cols=vjs(table_row,':scope > :not([style*="display:none"])',true);const index=visible_cols.indexOf(element);const cur_width=widths.length>index?widths[index]:1;return"flex-basis:"+100*cur_width/sum_widths+"%;"}}catch(error){kh_log.error?.(T9`error in ${kh_js.currentFunctionName()} => ${error}`);return""}}export function createCols(element,create_params){try{element=vjs(element);if(kh_js.isEmpty(element))throw new kh_js.Error("invalid-argument");element=element[0];let row_element=element;if(!kh_js.isValid(row_element))throw new kh_js.Error("Invalid DOM structure");let table=row_element.parentNode;if(!kh_js.isValid(table))throw new kh_js.Error("Invalid DOM structure");let cell_create_f=vjs.data(table,"kh-cms-cell-create");if("function"!==typeof cell_create_f)cell_create_f=undefined;row_element.classList.add("kh-hlayout");create_params=kh_js.isValid(create_params)&&!kh_js.isValid(create_params.empty_list)?create_params:vjs.data(row_element,"kh-cms-opt");if(kh_js.isValid(create_params)&&!((create_params=LVC.tryLVC(create_params))instanceof LVC)&&!Array.isArray(create_params)){create_params=unzipProp(create_params,false,element)}if(!kh_js.isValid(create_params))create_params="";if(kh_js.isString(create_params))create_params=create_params.split(",");let row_index=vjs.index(row_element);let ncols=vjs.data(table,"ncols")|0;const ncols2=vjs.attr(table,"data-ncols")|0;if(0!==ncols&&0!==ncols2&&ncols2!=ncols){kh_log.warn?.(T9`«${table.attr("id")}.ncols» - ${unzipProp("param-not-match",true)} - [${ncols}, ${ncols2}]`)}let create_cell=(cp,idx)=>{cp=LVC.tryLVC(cp);let col_index=row_element.children.length;const div=vjs.create("div",{id:`col-${col_index}`,class:`kh-table-col-${col_index}`,dataStyle:"@(calcColWidth())"});if(!kh_js.isEmpty(cp)){if(cp instanceof LVC){div.insertAdjacentHTML("beforeend",cp.label);vjs.attr(div,"title",cp.getAttribute("tt"))}else div.insertAdjacentHTML("beforeend",cp)}if(cell_create_f){let created_content=cell_create_f(row_index,col_index,div,cp,row_element);if("function"==typeof created_content){vjs.data(div,"col-refresh",(function(){vjs.setContent(div,created_content(div,cp,row_element))}));vjs.data(div,"col-refresh")()}else if(!kh_js.isEmpty(created_content)){vjs.setContent(div,created_content)}}row_element.append(div)};if(create_params instanceof LVC){if(!ncols)throw new Error(kh_js.StringMap.getGlobalMap()["param-not-determined"]+" (ncols)");[...Array(ncols)].map(((v,i)=>create_params)).forEach(create_cell)}else if(Array.isArray(create_params)){if(!ncols)ncols=create_params.length;else{let param=[];param[0]=ncols<create_params.length?create_params.length-1:create_params.length;param[1]=ncols<create_params.length?create_params.length-ncols:0;if(ncols>create_params.length)param=param.concat(new Array(ncols-create_params.length));create_params.splice.apply(create_params,param)}create_params.forEach(create_cell)}return true}catch(error){kh_log.error?.(T9`error in ${kh_js.currentFunctionName()} => ${error}`);return false}}export function createRows(element,create_params){try{element=vjs(element);if(kh_js.isEmpty(element))throw new kh_js.Error("invalid-argument");element=element[0];let table_element=element;if(!kh_js.isValid(table_element))throw new kh_js.Error("Invalid DOM structure");create_params=kh_js.isValid(create_params)&&!kh_js.isValid(create_params.empty_list)?create_params:vjs.data(table_element,"kh-cms-opt");if(kh_js.isValid(create_params)&&!Array.isArray(create_params))create_params=unzipProp(create_params,false,element);if(Array.isArray(create_params)){create_params.forEach(((cp,idx)=>{if(!((cp=LVC.tryLVC(cp))instanceof LVC)&&!Array.isArray(cp))cp=[cp];let row_index=table_element.children.length;const div=document.createElement("div");div.classList.add("kh-hlayout",`kh-table-row-${row_index}`);vjs.attr(div,"id",`row-${row_index}`);vjs.data(div,"create-data",cp);vjs.attr(div,"data-create","@(createCols())");table_element.append(div)}))}return true}catch(error){kh_log.error?.(T9`error in ${kh_js.currentFunctionName()} => ${error}`);return false}}export function registerNodesWithMutationObserver(selector,callback_selector,callback_process,moi,data){let ok=kh_js.isValid(selector)&&kh_js.isValid(callback_selector)&&kh_js.isValid(callback_process)&&kh_js.isValid(moi);if(!ok)return;const observer_funcs=cs["f-observer"]??=new kh_js.Map2Array;const observer=cs["observer"]??=new MutationObserver(((mutations,mo)=>{mutations.forEach((mutation=>{try{let onMutation=map_value=>{let rslt_selector_cb=map_value["callback_selector"](mutation);kh_log.trace?.(T9`onMutation@${vjs.attr(mutation.target,"id")} => ${mutation.attributeName??mutation.type} | ${rslt_selector_cb} | ${map_value.data}`);let selec="boolean"===typeof rslt_selector_cb?rslt_selector_cb?vjs(mutation.target):undefined:vjs(rslt_selector_cb);return kh_js.isValid(selec)?map_value["callback_process"](selec,map_value.data,map_value.node):undefined};observer_funcs.get(mutation.target)?.forEach(onMutation);observer_funcs.get(mutation.type)?.forEach(onMutation)}catch(error){kh_log.error?.(T9`error during execution mutation callback => ${error}`)}}))}));cs["kh-mo-nodes-register"]??=new Set;let register_f=(sta,node)=>{try{if(cs["kh-mo-nodes-register"].has(node)){kh_log.warn?.(T9`duplicate registration for ${node.getAttribute("id")??node}, previou observation will be canceld`)}cs["kh-mo-nodes-register"].add(node);observer.observe(node,moi);let inner_register_f=map_key=>{observer_funcs.add(map_key,{callback_selector,callback_process,moi,data,node:moi.subtree?node:undefined})};if(kh_js.isEmpty(sta))inner_register_f(node);else sta.forEach(inner_register_f)}catch(error){kh_log.error?.(T9`error in ${kh_js.currentFunctionName()} => ${error}`)}};let subtree_args=[];if(true===moi.subtree){subtree_args.push(...["childList","attributes","characterData"].filter((sta=>moi[sta])))}vjs(selector)?.forEach((node=>register_f(subtree_args,node)))}export function registerNodesWithTemplateContent(selector,selector_callback,attributeFilter,key_list){let moi={attributes:true,attributeFilter};registerNodesWithMutationObserver(selector,selector_callback,((_selector,_key_list)=>kh_js.isValid(_selector)?processTemplateContent(_selector,_key_list,"async"):false),moi,key_list)}export function after(events){return{after:Array.isArray(events)?events:kh_js.isEmpty(events)?[]:[events]}}export function before(events){return{before:Array.isArray(events)?events:kh_js.isEmpty(events)?[]:[events]}}export const converter=cvt_f=>({converter:cvt_f});const dyn$eventMap={before:new class extends kh_js.Map2Array{constructor(){super(((v1,v2)=>v1.node==v2.node&&v1.flag==v2.flag))}clean(event){let dead_entries=this.get(event)?.filter((entry=>!document.documentElement.contains(entry.node)));if(!kh_js.isEmpty(dead_entries))this.remove(event,dead_entries);return this.get(event)}process(event){this.clean(event)?.forEach((entry=>entry.trigger?.()))}},after:new class extends kh_js.Map2Array{constructor(){super(((v1,v2)=>v1.node==v2.node&&v1.flag==v2.flag))}clean(event){let dead_entries=this.get(event)?.filter((entry=>!document.documentElement.contains(entry.node)));if(!kh_js.isEmpty(dead_entries))this.remove(event,dead_entries);return this.get(event)}process(event){this.clean(event)?.forEach((entry=>entry.trigger?.()))}}};export function dynset(node,attr){node=vjs(node);let ok=1==node?.length;if(!ok){kh_log.error?.(T9`${unzipProp("invalid-usage-of",true,node)} ${unzipProp("of",true,node)} ${kh_js.getTypeName(node)}`+T9`${unzipProp("for",true,node)} ${kh_js.currentFunctionName()}`);return undefined}node=node[0];let obj=attribute(node,attr,"full",true);if(!kh_js.isValid(obj?.parent)||!kh_js.isValid(obj?.property)){kh_log.warn?.(T9`${obj} ${unzipProp("resolved-for",true,node)} ${attr} => ${unzipProp("param-invalid",true,node)} `+T9`${unzipProp("for",true,node)} ${kh_js.currentFunctionName()}`);return undefined}const simple_setter=value=>{if(obj.parent instanceof Map)obj.parent.set(obj.property,value);else obj.parent[obj.property]=value};const setter=node_or_event=>{const fromNode=node_or_event.target??node_or_event;switch(fromNode.tagName){case"INPUT":{switch(fromNode.type){case"radio":case"checkbox":{if("checked"!=obj.property)break;simple_setter(fromNode.checked);break}default:{if("value"!=obj.property)break;simple_setter(fromNode.value);break}}break}case"UL":case"OL":{const new_list=vjs(node,":scope > *",true)?.map((child=>vjs.data(child,"each")));simple_setter(new_list);break}default:kh_log.error?.(T9`${unzipProp("invalid-usage-of",true,fromNode)} ${fromNode.tagName} `+T9`${unzipProp("for",true,fromNode)} ${kh_js.currentFunctionName()}`)}};let hasCondition=false;for(let i=2;i<arguments.length;++i){const arg=arguments[i];if(!kh_js.isObject(arg))continue;["after","before"].forEach((condition=>{if(!(condition in arg))return;let events=arg[condition];if(kh_js.isEmpty(events))return;if(!Array.isArray(events))events=[events];let map=dyn$eventMap[condition];events.forEach((event=>{map.clean(event);map.add(event,[{node,trigger:setter.bind(undefined,node),flag:"dynset"}])}));hasCondition=true}))}switch(node.tagName){case"INPUT":{if(!hasCondition){const ns=`${name}.dynset.${obj.property}`;vjs.off(`.${ns}`,undefined,node);vjs.on(`change.${ns}`,(event=>{if("radio"==event.target.type&&"fake"!=event.detail?.mode){vjs(`input[name=${event.target.name}]`,true).filter((input=>event.target!=input)).forEach((input=>vjs.postEvent("change",input,{mode:"fake"})))}setter(event)}),node)}break}case"UL":case"OL":{registerNodesWithMutationObserver(node,(mutation=>{const can_process=vjs.data(node,"kh-cms-processed").has("content");return can_process&&"childList"===mutation.type&&(!kh_js.isEmpty(mutation.addedNodes)||!kh_js.isEmpty(mutation.removedNodes))}),((selector,data,was_base_node)=>{setter(node);return undefined}),{childList:true,subtree:false},undefined);break}default:kh_log.error?.(T9`${unzipProp("invalid-usage-of",true,node)} ${node.tagName} `+T9`${unzipProp("for",true,node)} ${kh_js.currentFunctionName()}`)}return""}export function dynget(node,attr){kh_log.trace?.(T9`Id (${node.getAttribute("id")??"N.N."}) come with dynget(${attr}) `+T9`${"maithai_01"==node.getAttribute("id")?`/${attribute(node,"each.attributes.value",true)?.substring(0,10)??""}/`:``}`);const const_val=kh_js.isString(attr)&&attr.startsWith("!");let obj=const_val?attr.substring(1):attribute(node,attr,"full",true);if(!const_val&&!kh_js.isValid(obj?.val)){kh_log.warn?.(T9`${obj} ${unzipProp("resolved-for",true,node)} ${attr} => ${unzipProp("param-invalid",true,node)} `+T9`${unzipProp("for",true,node)} ${kh_js.currentFunctionName()}`);return undefined}let converter=val=>val??"";const trigger=()=>processTemplateContent(node,undefined,"async");let hasCondition=false;for(let i=2;i<arguments.length;++i){const arg=arguments[i];if(!kh_js.isObject(arg))continue;["after","before","converter"].forEach((condition=>{if(!(condition in arg))return;if("converter"===condition){let f=$eval(arg[condition]);converter=f??converter}else{let events=arg[condition];if(kh_js.isEmpty(events))return;if(!Array.isArray(events))events=[events];let map=dyn$eventMap[condition];events.forEach((event=>{map.clean(event);map.add(event,[{node,trigger,flag:"dynget"}])}));hasCondition=true}}))}if(!hasCondition){if(const_val){kh_log.error?.(T9`${unzipProp("invalid-usage-of",true,node)} 'const val' / attr(${attr.substring(1)}) `+T9`${unzipProp("for",true,node)} ${kh_js.currentFunctionName()}`);return undefined}if(obj.parent instanceof Map){const set_f=obj.parent.set;obj.parent.set=function(key,value){set_f.call(obj.parent,key,value);trigger()}}else{let val=obj.val;Object.defineProperty(obj.parent,obj.property,{configurable:true,enumerable:true,set(new_val){val=new_val;trigger()},get(){return val}})}}return converter(const_val?obj:obj.val)}export function string(){if(0==arguments.length)return"";let a=[...arguments].map((function(s){s?.trim();if(kh_js.isEmpty(s))return"";let c0=s.charAt(0);let p0=('"'==c0||"'"==c0)&&1<s.length&&c0==s.at(-1)?1:0;return 1==p0?s.substring(p0,s.length-1):s}));return a.join("")}export function stringify(){if(0==arguments.length)return"";let a=[...arguments].map((function(s){return`"${s}"`}));return a.join("")}export function style(styleName,element=document?.body,newVal){return vjs.style(element,styleName,newVal)}export function css(varName,element=document?.body,newVal){if(!kh_js.isValid(newVal)){return vjs.cssvar(element,varName)||kh_js.StringMap.getGlobalMap()["css"+varName.substring(1)]||""}else return vjs.cssvar(element,varName,newVal)}export function attribute(node,attr,recurse=false,for_request=false){node=vjs(node,true)??node;if(Array.isArray(node))node=node[0];if(!kh_js.isValid(node))return undefined;if(kh_js.StringMap.getGlobalMap()["vjs-switch-flag"]==attr)switchNodes.add(node);if(!kh_js.isString(attr))return attr;let val=undefined;attr=attr??"attribute";attr=attr.split(/\./);let parent=undefined;do{while(true){if(kh_js.isEmpty(node))return undefined;val=resolveVar(attr[0],node);if(kh_js.isValid(val))break;if(true!==recurse&&"full"!=recurse&&"prev"!=recurse)return undefined;node=keyWordsResolver.get("prev"==recurse?"previousSibling":"parent")(node)}for(let i=1;i<attr.length;++i){parent=val;val=resolveVar(attr[i],val);if(!kh_js.isValid(val)&&i!=attr.length-1){parent=undefined;break}}if(!kh_js.isValid(val)&&"full"==recurse){node=keyWordsResolver.get("parent")(node)}else break}while(true);return!for_request?val:!kh_js.isValid(parent)?undefined:{parent,property:attr.at(-1),val}}export function uuid2(counter,prefix){if(!Array.isArray(counter))throw new Error(kh_js.StringMap.getGlobalMap()["invalid-usage-of"]+" uuid2()");let inc_pos=idx=>{if("9"==counter[idx])counter[idx]="A";else{const val=counter[idx].charCodeAt(0)+1;counter[idx]=String.fromCharCode(val)}};let i=counter.length-1;while(true){if("Z"==counter[i]){counter[i]="0";--i;if(0>i){counter=[...Array(5)].map(((_k,_v)=>"0"));i=counter.length-1}}else{inc_pos(i);break}}return(prefix||"__kh_")+counter.join("")}export function uuid3(prefix,init=[]){if(!Array.isArray(init)||!Array.isArray(this))throw new Error(kh_js.StringMap.getGlobalMap()["invalid-usage-of"]+" uuid3()");const o_this=this;this.next=()=>uuid2(this,prefix||"___kh_-");this.reset=function(){for(let i=0;i<o_this.length;++i){o_this[i]=init.length>i?init[i]:"0"}};this.reset();return this}export function uuid(){if(!kh_global["kh-uuid"])kh_global["kh-uuid"]="0".repeat(5).split("");return uuid2(kh_global["kh-uuid"],"_kh_-")}export function reduce(obj,max_n=20,weakmap=new WeakMap,path="/"){if(kh_js.isString(obj)){try{return reduce(JSON.parse(obj),max_n,weakmap,path)}catch(e){if(0>max_n)return 2*Math.abs(max_n)+3>=obj.length?obj:obj.substring(0,Math.abs(max_n))+"..."+obj.substring(obj.length+max_n);else return obj.substring(0,max_n)+(max_n<obj.length?"...":"")}}else if(kh_js.isObject(obj)){let ref_path=weakmap.get(obj);if(undefined!=ref_path)obj=`=>${ref_path}`;else{weakmap.set(obj,path);obj=Object.assign({},obj);kh_js.for_in(obj,((k,v)=>obj[k]=reduce(obj[k],max_n,weakmap,`${path}${k}/`)))}}return obj}export function empty(what,{empty_list=false}={}){return empty_list||kh_js.isEmpty(what)}export const condition=(test,if_true,if_false)=>{if(kh_js.isString(test))test=kh_js.string2bool(test)??test;if(!kh_js.isValid(test))return if_false;return true==test?if_true:if_false};export const not=v=>!kh_js.string2bool(v);export const and=(v1,v2)=>kh_js.string2bool(v1)&&kh_js.string2bool(v2);export const or=(v1,v2)=>kh_js.string2bool(v1)||kh_js.string2bool(v2);export const equals=(v1,v2)=>v1==v2;export function first(){const result=[...arguments].find(((arg,idx,arr)=>kh_js.isValid(arg)&&(idx==arr.length-1||true!=arr[idx]?.empty_list)));return result}export const equals2=(v1,v2)=>v1?.equals?.(v2)??v1===v2;export function command(cmd,elem,...argz){if(!kh_js.isValid(cmd))return undefined;const s1=argz.map((arg=>{if(arg.startsWith?.("eval("))return arg;return JSON.stringify(arg)})).join(",");const elem_id=vjs.attr(elem,"id");return`${cf}.doCommand('${cmd}', event, ${!kh_js.isEmpty(elem_id)?`"#${elem_id}"`:null}, ...(argz || []) ${0<s1.length?","+s1:""})`}export function doCommand(cmd,event,elem,...argz){dyn$eventMap.before.process(cmd);vjs.trigger(cmd,elem?[elem]:registeredMainwindows(),{event:event||window.event,argz});dyn$eventMap.after.process(cmd)}export const toLower=s=>s.toLowerCase();export const toUpper=s=>s.toUpperCase();export function $eval(code,element){const[_1,_2,...argz]=[...arguments];return eval2(code,true,{self:element,argz},...argz)}export function eval2(code,copy_context=true,thisArg){try{if(kh_js.isEmpty(code=(code||"").trim()))return undefined;if(!code.startsWith("return "))code="return "+code;code="var kh_js= globalThis.kh.storage.kh_js;var kh_cms= globalThis.kh.storage.kh_cms;"+code;if(copy_context){code="var f_argz= [ ...arguments ];"+"if (this!= globalThis) { "+"for (let __key in this) {"+"if (this.hasOwnProperty(__key)) "+'eval("var " + __key + " = this[__key];");'+"}"+"}"+code}let[_1,_2,_3,...argz]=[...arguments];let f=new Function(code);return f.apply(thisArg,argz)}catch(error){kh_log?.error?.(T9`${error} ${kh_js.StringMap.getGlobalMap()["invalid-argument"]} ${code} | ${kh_js.StringMap.getGlobalMap()["during-execution"]} `+T9`${kh_js.StringMap.getGlobalMap()["of"]} eval2`);return undefined}}export function argz(element,argz_name="kh-cms-opt"){if(kh_js.isjQuery(element))element=element.get(0);if(!kh_js.isValid(element))return undefined;const argz=attribute(element,argz_name,true);return!kh_js.isValid(argz)?argz:get_prop(argz,"data_argz")??argz}export function sub_argz(element,sub_arg,argz_name="kh-cms-opt"){let argz_val=argz(element,argz_name);if(!kh_js.isValid(argz_val)||!kh_js.isValid(sub_arg))return argz_val;sub_arg=sub_arg.split(/\./);for(let i=0;i<sub_arg.length;++i){argz_val=get_prop(argz_val,sub_arg[i]);if(!kh_js.isValid(argz_val))break}return argz_val}export function safe_val(value,def_value=""){if(kh_js.isEmpty(value))return def_value;if(!kh_js.isString(value)){value=JSON.stringify(value)}return" "+value.trim()}export function class_concat(){return class_pretty([...arguments],true)}export function inlineStyle2CSS(style,unzip=true){if(unzip)style=unzipProp(style,false);return vjs.inlineStyle2CSS(style)}export const CSS2inlineStyle=vjs.CSS2inlineStyle;export function model(element,argz_name="kh-cms-opt",model_name="model"){let argz_obj=argz(element,argz_name);if(!kh_js.isValid(argz_obj))return argz_obj;return argz_obj[model_name]}export function checkRef(ref,force_ref_type){let ret={};if(!kh_js.isString(ref)||kh_js.isEmpty(ref)||true==force_ref_type?.empty_list)return ret;const result={isBookmark:"#"==ref.charAt(0),isCommand:"@"==ref.charAt(0),isQuery:-1!=ref.indexOf("?"),isMail:-1!=ref.indexOf("UnCryptMailto")};result.isURL=!result.isBookmark&&!result.isCommand&&!result.isMail&&"none"!==ref;let true_value={value:ref};const empty_force_ref_type=kh_js.isEmpty(force_ref_type);const is_plain_object=kh_js.isPlainObject(force_ref_type);const is_array=Array.isArray(force_ref_type);const field_names=["isBookmark","isCommand","isQuery","isMail","isURL"];field_names.forEach((fn=>{if(empty_force_ref_type||fn===force_ref_type||is_plain_object&&true===force_ref_type[fn]||is_array&&-1!=force_ref_type.find(fn))ret[fn]=result[fn]?true_value:undefined}));return ret}export function elementClick(thisArg){const element=thisArg.self??thisArg;let click_info=kh_js.isValid(element)?attribute(element,"data-is",true):undefined;if(!kh_js.isValid(click_info))return;let lvc=attribute(element,"each",true);lvc=LVC.tryLVC(lvc);let parameter={c:element,lvc,col_nr:vjs.data(element,"col-nr")};if(!kh_js.isEmpty(click_info["isBookmark"])){parameter={...parameter,bookmark:click_info["isBookmark"].value};onMenuItemLight(parameter)}else if(!kh_js.isEmpty(lvc.getAttribute(kh_js.WindowArgs.value))){const cmd=attribute(element,"data-column-more",true);if(kh_js.isEmpty(cmd)){kh_log.error?.(T9`${unzipProp("param-not-determined",true,element)} -> 'data-column-more'`);return}doCommand(cmd,undefined,element,parameter)}else{alert(T9`implement ${Object.entries(click_info).filter((([k,v])=>v)).map((([k,v])=>k))} in ${kh_js.currentFunctionName()} for ${vjs.attr(element,"id")}`)}}export function onMenuItemLight(param){if(kh_js.isEmpty(param))return;window.location.href=param.bookmark}export function canParagraph(text){if(kh_js.isEmpty(text))return false;const p=vjs.create("p",{content:text});return 1>=(p?.children?.length??0)||[...p?.children].every((node=>"BR"==node.tagName))}export function createHtmlContent(text,class_value,style_value,as_string=false){if(kh_js.isEmpty(text))return"";let tagName=canParagraph(text)?"p":"span";style_value=CSS2inlineStyle(inlineStyle2CSS(style_value)??{});class_value=class_pretty(class_value);const node=vjs.create(tagName,{class:class_value,style:style_value,content:text});return as_string?node?.outerHTML:node}export function respectSelective(element){return false}export function toggle_click(element){element=vjs(element);if(kh_js.isEmpty(element))return;let prev=element[0].previousElementSibling;if(!prev)return}export function nChilds(n,{ui_model="text"}={}){const lvc=new LVC({attributes:[["ui_model",ui_model]]});return[...Array(n)].map((()=>lvc))}export async function onReadyStd(app_context,{watch_content=true,watch_load=false,watch_hideit,id_prefix,ui_loader}={}){try{await vjs.onReadyStd(...arguments);let id_count=uuid3.call([...Array(6)],id_prefix);genUUID=()=>id_count.next();const ret_promise=(ui_loader??(()=>Promise.resolve()))().then((ui=>{cs.$ui=ui??{};return setMainWindow(app_context.getMainWindow(),app_context)}));let watcher;vjs.data(vjs.html,"watcher",watcher=function(base=vjs.html){if(true==watch_content){let watched_attrs_load=["data-content"];registerNodesWithTemplateContent(vjs(base,"[data-content]",true),(mutation=>{let result="attributes"==mutation.type&&-1!=watched_attrs_load.indexOf(mutation.attributeName);return result}),watched_attrs_load,["content"])}if(true==watch_load){let watched_attrs_load=["data-load","data-load-data"];registerNodesWithTemplateContent(vjs(base,"[data-load]",true),(mutation=>{let result="attributes"==mutation.type&&-1!=watched_attrs_load.indexOf(mutation.attributeName);return result}),watched_attrs_load,["load"])}if(!kh_js.isEmpty(watch_hideit)){registerNodesWithTemplateContent(vjs(base,watch_hideit,true),(mutation=>{if("class"===mutation.attributeName){let attributeValue=mutation.target.getAttribute(mutation.attributeName);return-1==attributeValue.indexOf("hide-it")}}))}});watcher();return ret_promise}catch(error){return Promise.reject(error)}}export class LVC{#label_;#value_;#constraint_;#status_;#attributes_;constructor({label="",value=null,constraint="",status=true,attributes={}}={}){this.#label_=label;this.#value_=value;this.#constraint_=constraint;this.#status_=status;this.#attributes_=new Map(Array.isArray(attributes)?attributes:Object.entries(attributes))}get label(){return this.#label_}set label(l){this.#label_=label}get value(){return this.#value_}set value(v){this.#value_=v}get constraint(){return this.#constraint_}get status(){return this.#status_}set status(s){this.#status_=s}get attributes(){return this.#attributes_}setAttributes(attrs,mode){this.#attributes_=attrs}set defValue(def_v){this.setAttribute(kh_js.WindowArgs.value_def,def_v)}get defValue(){return this.getAttribute(kh_js.WindowArgs.value_def)}setAttribute(name,value){return this.#attributes_.set(name,value)}getAttribute(name,def){return this.#attributes_.get(name)||def}hasAttribute(name){return this.#attributes_.has(name)}get isValid(){return""!==this.#label_||null!=this.#value_||0!=this.#attributes_.size}toJSON(){return kh_js.Class.toJSON(this,["label",{key:"value",value:""},{key:"constraint",val:""},{key:"status",value:"true"},{key:"attributes",value:val=>kh_js.isEmpty(val),converter:val=>Object.fromEntries(val.entries())}])}clone(){return LVC.tryLVC(this.toJSON())}static tryLVC(s){try{if(s instanceof LVC||null==s||undefined==s)return s;let lvc=new LVC(kh_js.isString(s)?JSON.parse(s):kh_js.isObject(s)?s:undefined);return kh_js.isValid(lvc)?lvc:s}catch(e){return s}}}export function parse_child_div(lvc,content){if(kh_js.isEmpty(lvc.getAttribute("orient")))lvc.setAttribute("orient",content.orient??"flex");lvc.setAttribute(kh_js.WindowArgs.classz,`${lvc.getAttribute(kh_js.WindowArgs.classz)??""} ${class_from_orient(lvc.getAttribute("orient"))}`)}export function parse_htr(lvc,content){if(!(lvc instanceof LVC)){const ui_model=lvc.ui_model;lvc=LVC.tryLVC(lvc);if(!(lvc instanceof LVC))return undefined;lvc.setAttribute(kh_js.WindowArgs.ui_model,"htr")}if(true!=lvc.getAttribute("internal_processed")){const has_ext_text=!kh_js.isEmpty(lvc.getAttribute(kh_js.WindowArgs.value));const has_url=!kh_js.isEmpty(lvc.getAttribute(kh_js.WindowArgs.url));if(!has_ext_text&&!has_url)lvc.setAttribute(kh_js.WindowArgs.url,"none");lvc.setAttribute("internal_processed",true)}return lvc}export const ui_parser=new Map([["child-div",parse_child_div]]);export function ui({dataset=cs.$ui,ui_id,elem}={}){try{if(kh_js.isString(arguments[0])){ui_id=arguments[0];elem=arguments[1]}let content=dataset[ui_id]??dataset;if(kh_js.isEmpty(content))return undefined;if(kh_js.isString(content)){}if(!Array.isArray(content))content=[content];content=content.map(((content_entry,index)=>{const ret=LVC.tryLVC(content_entry);if(!kh_js.isEmpty(content_entry.childs)&&Array.isArray(content_entry.childs)){let childs=content_entry.childs;if(kh_js.isValid(content_entry["childs-mapper"])){childs=childs.map(((child,index)=>{if(true===child?.["as-is"])return child;let cm=kh_js.cloneObject(content_entry["childs-mapper"]);kh_js.for_in(cm,((k,v)=>{if(k.startsWith("child"))return;const must_convert=!kh_js.isString(v);if(must_convert)v=JSON.stringify(v);v=v.replace(/\${[^}]*}/g,(match=>eval2(match.substring(2,match.length-1),true,{child,index})));cm[k]=must_convert?JSON.parse(v):v}));return cm}))}childs=childs.map((child=>ui({dataset:child})));ret.setAttribute("childs",childs)}if(kh_js.isEmpty(ret.getAttribute(kh_js.WindowArgs.ui_model))){ret.setAttribute(kh_js.WindowArgs.ui_model,content_entry[kh_js.WindowArgs.ui_model]??"child-div")}{const ui_model=ret.getAttribute(kh_js.WindowArgs.ui_model);const f=ui_parser.get(ui_model)??cs[`parse_${ui_model}`];f?.(ret,content_entry)}ret.setAttribute("from",kh_js.isValid(ui_id)?ui_id:index|0);return ret}));if(1==content.length&&kh_js.isValid(elem)&&true!==content[0].getAttribute("stay")){vjs.onoff(unzipProp("cms-event-ready-tc"),((event,my_elem_test)=>{if(my_elem_test(event))elem.replaceWith(...elem.children)}),window,(event=>event.detail?.node?.equals(vjs(elem.children))))}return 1==content.length?content[0]:content}catch(error){kh_log.error?.(T9`error in ${kh_js.currentFunctionName()} => ${error}`);debugger}}kh_global.kh.storage.kh_js.unzipString=s=>unzipProp(s,true);kh_global.kh.storage.kh_js.unzipProp=(label_key,must_key,element,do_not_trim)=>unzipProp(label_key,must_key,element,do_not_trim);import{class_from_orient,orient_from_class,class_pretty}from"/contrib/jsm/kh_components_base.js";Object.assign(cs,{calcColWidth,createCols,createRows,string,stringify,css,after,before,converter,dynget,dynset,attribute,reduce,class_from_orient,orient_from_class,empty,condition,not,and,or,equals,equals2,first,command,doCommand,toLower,toUpper,$eval,argz,sub_argz,safe_val,class_concat,inlineStyle2CSS,CSS2inlineStyle,model,checkRef,elementClick,onMenuItemLight,canParagraph,createHtmlContent,respectSelective,toggle_click,nChilds,ui,unzipProp});Object.assign(cs,{parse_child_div,parse_htr});kh_global.LoadedScripts.get(mf).resolve(ms);