const kh_global=Function("return globalThis;")()||Function("return this;")()||Function("return self;")();const as_module=undefined==this;const asWorker="undefined"===typeof window&&"undefined"===typeof process&&self;const cf="fairusell_server";const mf="fairusell_server_esm";kh_global.kh??={};kh_global.kh.context??="undefined"!==typeof window?kh_global.parent==kh_global?"window":"iframe":"undefined"!==typeof process?"node.js":"undefined"!==typeof self?self.name??"worker":"unknown";kh_global.kh.storage??={};const cs=kh_global.kh.storage[cf]??={cf,ms:new Set};const ms=kh_global.kh.storage[mf]??={mf,cs};cs.ms.add(ms);import*as path from"path";import*as fs from"fs";(async function server_module(){"use strict";if(!cs.app){let common_path=undefined;try{if(fs.statSync(path.resolve("./common/")).isDirectory())common_path="./common/";if("developement"===process.env.NODE_ENV)console.log("must not go thru catch; old style directoory structure?")}catch(error){if("developement"!==process.env.NODE_ENV)console.log("must go thru catch; maybe wrong deployment");if(fs.statSync(path.resolve("../common/")).isDirectory())common_path="../common/"}common_path=path.resolve(common_path);import(`file:///${common_path}/server.mjs`).then((module=>module.main())).then((async app=>{cs.app=app;const kh_server=kh_global.kh.storage["kh_server"];kh_global.LoadedScripts.get("common_server_esm").then((kh_server_ms=>{const kh_server_2=kh_server_ms.cs;console.assert(kh_server==kh_server_2,"must same")}));const jsm_prefix="undefined"!==typeof process?`file:///${kh_global.kh.pathes.get("own-module")}`:`/contrib/jsm`;const common_prefix=`file:///${kh_global.kh.pathes.get("common")}`;let print_level=undefined;const{Logger}=await import(`${jsm_prefix}/kh_log${VERSION}.js`);const kh_log=new Logger(print_level,(()=>MF`${mf}`));kh_global.LoadedScripts.get(mf).resolve(ms)}))}})();