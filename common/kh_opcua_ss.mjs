const kh_global=Function("return globalThis;")()||Function("return this;")()||Function("return self;")();const as_module=undefined==this;const asWorker="undefined"===typeof window&&"undefined"===typeof process&&self;const cf="kh_opcua_ss";const mf="kh_opcua_ss_esm";kh_global.kh??={};kh_global.kh.context??="undefined"!==typeof window?kh_global.parent==kh_global?"window":"iframe":"undefined"!==typeof process?"node.js":"undefined"!==typeof self?self.name??"worker":"unknown";kh_global.kh.storage??={};const cs=kh_global.kh.storage[cf]??={cf,ms:new Set};const ms=kh_global.kh.storage[mf]??={mf,cs};cs.ms.add(ms);import*as kh_js_e from"/contrib/jsm/kh_earlybird.js";import*as kh_js_c from"/contrib/jsm/kh_classes.js";import*as kh_js_f from"/contrib/jsm/kh_functions.js";const kh_js=Object.assign({...kh_js_e},{...kh_js_c},{...kh_js_f});const name=MF`${mf}`;const print_level=undefined;import{Logger}from"/contrib/jsm/kh_log.js";const kh_log=new Logger(print_level,(()=>name));import*as crypto from"node:crypto";import*as fs from"node:fs";import*as fsPromises from"node:fs/promises";import*as path from"node:path";import{EOL,tmpdir}from"node:os";import*as opcua from"node-opcua";import{DurationTime}from"/contrib/jsm/kh_duration.js";import{Int64_to_BigInt,UInt64_to_BigInt,get_toJSON}from"/common/kh_opcua_ss_prototypes.mjs";import{getFileFromStaticPathes}from"/common/files_from_pathes.mjs";const node_opcua_client_std_options=Object.freeze({applicationName:"KH_OPCUA",clientName:"KH_OPCUA Client",connectionStrategy:{initialDelay:1e3,maxDelay:1e4,maxRetry:3},securityMode:opcua.MessageSecurityMode.None,securityPolicy:opcua.SecurityPolicy.None,endpointMustExist:false,endpointUrl:""});export{opcua as backend};export class Client{#options_;#session_;#endpoints_;#client_;#data_types_=new Map;#def_subscription_;constructor(options={}){this.#options_=kh_js.JSON8MergePatch.apply(kh_js.cloneObject(node_opcua_client_std_options),options,{assign:true});if(kh_js.isString(this.#options_.timeout))this.#options_.timeout=DurationTime.Millis(this.#options_.timeout);if(!kh_js.isValid(options.connectionStrategy)&&kh_js.isValid(this.#options_.timeout)){this.#options_.connectionStrategy={initialDelay:this.#options_.timeout,maxDelay:2*this.#options_.timeout,maxRetry:3}}process.env.NODEOPCUADEBUG="TRACE"}isConnected(){return"connected"==this.#client_._internalState&&kh_js.isValid(this.NativeSession)}get NativeClient(){return this.#client_}get NativeSession(){return this.#session_}get Endpoints(){return this.#endpoints_}get AppName(){return this.#client_.applicationName??this.#options_.applicationName}get ClientName(){return this.#client_.clientName??this.#options_.clientName}get ServerURI(){return this.#client_.serverUri??kh_js.StringMap.getGlobalMap()?.["not.connected"]}get FullName(){return`${this.AppName}@${this.ClientName}@${this.ServerURI}`}async create_and_connect(browse_root=true){let file_delete_promise=()=>Promise.resolve(true);if(!kh_js.isEmpty(this.#options_.securityPolicy)&&"http://opcfoundation.org/UA/SecurityPolicy#None"!==this.#options_.securityPolicy){const pathes=[kh_global.kh.pathes.get("common"),...kh_global.kh.storage.kh_server.server_options.app_settings?.static_files_pathes??[]];this.#options_.certificateFile=getFileFromStaticPathes(kh_global.kh.storage.kh_server.server_options.cert_file.substring(2),pathes);this.#options_.privateKeyFile=getFileFromStaticPathes(kh_global.kh.storage.kh_server.server_options.key_file.substring(2),pathes);let pem=fs.readFileSync(this.#options_.privateKeyFile,"utf8");if(-1!=pem.indexOf("ENCRYPTED")){const pK=crypto.createPrivateKey({key:pem,format:"pem",passphrase:kh_global.kh.storage.kh_server.server_options.passw,encoding:"utf8"});pem=pK.export({type:"pkcs1",format:"pem"});const parsed=path.parse(this.#options_.privateKeyFile);const tmpPKName=tmpdir()+`/${parsed.name}_${kh_js.getRandomArbitrary()|0}${parsed.ext}`;fs.writeFileSync(tmpPKName,pem,"utf8");this.#options_.privateKeyFile=tmpPKName;file_delete_promise=()=>fsPromises.unlink(tmpPKName)}}this.#client_=opcua.OPCUAClient.create(this.#options_);const connect_promise=this.#client_.connect(this.#options_.endpointUrl);const create_session_promise=connect_promise.then((async()=>{kh_log.debug?.(`successfull connected to ${this.#options_.endpointUrl}!`);return this.#client_.createSession()}));const endpoint_promise=create_session_promise.then((async session=>{kh_log.debug?.(T9`session ${session.name} created !`);return this.#client_.getEndpoints()}));return Promise.all([connect_promise,create_session_promise,endpoint_promise]).then((async result=>{this.#session_=result[1];this.#endpoints_=result[2];kh_log.debug?.(T9`endpoints= ${this.#endpoints_}, event name=${this.NativeSession.eventNames()}`);this.NativeSession.readNamespaceArray().then((arr=>{kh_log.info?.(T9`namespace array= ${arr}`)}));return file_delete_promise()})).then((async()=>browse_root?this.browse():undefined)).then((async browseResult=>{browse_root&&kh_log.debug?.(T9`references of RootFolder : ${browseResult.references.map((r=>r.browseName.toString()))}`);return Promise.resolve(browse_root?{client:this,browseResult}:this)})).catch((async error=>{kh_log.error?.(T9`error during create and connect OPC UA client => ${error}`);throw error}))}async closeSession(session,deleteSubscriptions=true){kh_log.info?.(T9`session ${session.name}/${session.sessionId} will be closed, ${deleteSubscriptions?session.subscriptionCount:0} subscription(s) closed too`);session=this.#session_;return this.#client_.closeSession(session,deleteSubscriptions).then((async()=>true))}async browse(start="RootFolder"){if(Array.isArray(start))return Promise.all(start.map((start_entry=>this.browse(start_entry))));try{let continuationPoint;let browse_result;let __z=0;do{let cur_result;if(kh_js.isValid(continuationPoint)){cur_result=await this.NativeSession.browseNext(continuationPoint,false);continuationPoint=undefined}else{cur_result=await this.NativeSession.browse(start)}if(!kh_js.isValid(browse_result)){browse_result={...cur_result};delete browse_result.continuationPoint}else browse_result.references.push(...cur_result.references);continuationPoint=cur_result.continuationPoint;kh_log.trace?.(T9`**** step ${__z++} => ${browse_result.references.length??0} entries => ${browse_result.references.join("\n")}`)}while(kh_js.isValid(continuationPoint));return browse_result}catch(error){kh_log.error?.(T9`error during browse node ${start} => ${error}`)}}#getAttributeValue(attributes,attribute){return attributes.find((a=>a.attribute.id==(kh_js.isNumber(attribute,true)?attribute:Util.String2AttributeId(attribute))))}#getArrayType(arrayDimensions){if(!kh_js.isValid(arrayDimensions))return opcua.VariantArrayType.Scalar;arrayDimensions="value"in arrayDimensions?arrayDimensions.value:arrayDimensions;if(kh_js.isEmpty(arrayDimensions)||0==arrayDimensions[0])return opcua.VariantArrayType.Scalar;return 1<arrayDimensions.length?opcua.VariantArrayType.Matrix:opcua.VariantArrayType.Array}#getDimensionLength(arrayDimensions,dimension){if(!kh_js.isValid(arrayDimensions))return-1;arrayDimensions=arrayDimensions.value??arrayDimensions;if(kh_js.isEmpty(arrayDimensions)||0==arrayDimensions[0])return-1;return arrayDimensions[dimension]??-1}async writeValues(values){if(!kh_js.isValid(values))return undefined;if(!Array.isArray(values))values=[values];if(kh_js.isEmpty(values))return[];const attribute_promise=values.map((async value=>!kh_js.isValid(value.nodeId)?new kh_js.Error({msg:["param-not-determined","nodeId"]}):value instanceof opcua.WriteValue?value:{nodeId:value.nodeId,value:value.value,dataType:await this.readDataType(value.nodeId)}));return Promise.allSettled(attribute_promise).then((async results=>{const write_values_promises=results.map((async result=>{if("rejected"==result.status)return Promise.reject(result.reason);else{let writeValue;if(result.value instanceof opcua.WriteValue)writeValue=result.value;else{const dataType=result.value.dataType;const arrayDimension=dataType[1].value?.value??-1;if(!kh_js.isValid(dataType))return Promise.reject(new kh_js.Error({msg:["param-not-determined","dataType"]}));else{const arrayType=this.#getArrayType(dataType[2].value);const value=opcua.VariantArrayType.Scalar==arrayType?result.value.value:result.value.value.slice(0,this.#getDimensionLength(dataType[2].value,0));const dv=new opcua.DataValue({value:{arrayType,dataType:dataType[3].baseTypeId,dimension:null,value}});const dv2=new opcua.DataValue({value:new opcua.Variant({arrayType,dataType:dataType[3].baseTypeId,dimension:null,value})});writeValue=new opcua.WriteValue({attributeId:opcua.AttributeIds.Value,nodeId:result.value.nodeId,value:dv})}}return Promise.resolve(writeValue)}}));return Promise.allSettled(write_values_promises)})).then((results=>{const write_thru=results.every((result=>"fulfilled"==result.status));return write_thru?this.NativeSession.write(results.map((result=>result.value))):Promise.allSettled(results.map((result=>"rejected"==result.status?Promise.reject(result.reason):this.NativeSession.write(result.value))))})).catch((error=>{kh_log.error?.(T9`write values to opcua fails => ${error}`);return Promise.reject(error)}))}async readNodeAttributes(node_or_nodeId,chatty=false,internal=false){if(!this.isConnected)return[];const nodeId=node_or_nodeId.nodeId??node_or_nodeId;const nodesToRead=Util.allAttributeIds.map((attributeId=>({nodeId,attributeId:opcua.AttributeIds[attributeId]})));try{const dataValues=await this.NativeSession.read(nodesToRead);const results=[];for(let i=0;i<nodesToRead.length;++i){const nodeToRead=nodesToRead[i];const dataValue=dataValues[i];if(opcua.StatusCodes.Good!==dataValue.statusCode)continue;results.push({attribute:{name:Util.AttributeId2String(nodeToRead.attributeId),id:nodeToRead.attributeId},value:dataValue?.value?.value,dataValue,text:chatty?Util.cvtAttributeId2StringFromDataValue(nodeToRead.attributeId,dataValue):undefined});results[results.at(-1).attribute.name]=(()=>{const index=results.length-1;return()=>results[index]})()}if(!internal){const attribute$NodeClass=results[Util.AttributeId2String(opcua.AttributeIds.NodeClass)]();if(-1!=[opcua.NodeClass.ObjectType,opcua.NodeClass.VariableType,opcua.NodeClass.DataType,opcua.NodeClass.ReferenceType].indexOf(attribute$NodeClass.value)){const data_inf=await this.exploreTypeDefinition(nodeId);if(kh_js.isValid(data_inf))results.push(data_inf)}}return results}catch(error){kh_log.error?.(T9`error during ${kh_js.currentFunctionName()}= ${error}`);return[]}}async exploreTypeDefinition(nodeId4type,baseTypeId,baseType){let nodes_to_rework=[];if(!kh_js.isValid(baseType)&&kh_js.isValid(baseTypeId))baseType=Util.DataTypeId2String(baseTypeId);const enumNodeId=opcua.coerceNodeId(`ns=0;i=${opcua.DataTypeIds.Enumeration}`);const bdtNodeId=opcua.coerceNodeId(`ns=0;i=${opcua.DataTypeIds.BaseDataType}`);const bvtNodeId=opcua.coerceNodeId(`ns=0;i=${opcua.VariableTypeIds.BaseVariableType}`);const botNodeId=opcua.coerceNodeId(`ns=0;i=${opcua.ObjectTypeIds.BaseObjectType}`);const data_map_key_entry=kh_js.isString(nodeId4type)?nodeId4type:nodeId4type.toString();do{const data_map_key=kh_js.isString(nodeId4type)?nodeId4type:nodeId4type.toString();const data_inf=this.#data_types_.get(data_map_key);if(kh_js.isValid(data_inf))break;const attributes4type=await this.readNodeAttributes(nodeId4type,undefined,true);const parent4type=await this.browse(Util.defBrowseDesription({nodeId:nodeId4type,browseDirection:opcua.BrowseDirection.Inverse}));if(!kh_js.isEmpty(parent4type?.references)&&(opcua.sameNodeId(bdtNodeId,parent4type.references[0].nodeId)||opcua.sameNodeId(bvtNodeId,parent4type.references[0].nodeId)||opcua.sameNodeId(botNodeId,parent4type.references[0].nodeId))){parent4type.references=[]}const attribute$NodeClass=attributes4type[Util.AttributeId2String(opcua.AttributeIds.NodeClass)]();if(-1==[opcua.NodeClass.DataType,opcua.NodeClass.ObjectType,opcua.NodeClass.VariableType].indexOf(attribute$NodeClass?.value)){if(opcua.NodeClass.Object!==attribute$NodeClass?.value)debugger;break}let enumValues;if((!kh_js.isValid(baseType)||!kh_js.isValid(baseTypeId)||opcua.DataTypeIds.Enumeration==baseTypeId)&&!opcua.sameNodeId(enumNodeId,nodeId4type)){const references=await this.browse(Util.defBrowseDesription({nodeId:nodeId4type,referenceTypeId:opcua.ReferenceTypeIds.References}));if(!kh_js.isEmpty(references.references)&&-1!==["EnumStrings","EnumValues"].indexOf(references.references[0].browseName.name)){kh_log.assert?.(opcua.ReferenceTypeIds.HasProperty==references.references[0].referenceTypeId.value,"referenceTypeId must be `HasProperty`");kh_log.assert?.(opcua.VariableTypeIds.PropertyType==references.references[0].typeDefinition.value,"typeDefinition must be `PropertyType`");const ref_nodeId=references.references[0].nodeId;let enumStringsValues=await this.NativeSession.read({nodeId:ref_nodeId,attributeId:opcua.AttributeIds.Value});enumStringsValues=opcua.StatusCodes.Good!==enumStringsValues?.statusCode?undefined:enumStringsValues?.value?.value;enumValues={};if(!kh_js.isEmpty(enumStringsValues)){enumStringsValues.forEach(((esvEntry,index)=>{if(esvEntry instanceof opcua.EnumValueType||!kh_js.isEmpty(esvEntry.displayName)){enumValues[Int64_to_BigInt(esvEntry.value)]=esvEntry.displayName.text;enumValues[esvEntry.displayName.text]=Int64_to_BigInt(esvEntry.value)}else if(esvEntry instanceof opcua.LocalizedText||!kh_js.isEmpty(esvEntry.text)){enumValues[index]=esvEntry.text;enumValues[esvEntry.text]=index}}))}}}const attribute$BrowseName=attributes4type[Util.AttributeId2String(opcua.AttributeIds.BrowseName)]();this.#data_types_.set(nodeId4type.toString(),{baseType,baseTypeId,parent_type:parent4type.references?.[0]?.nodeId??false,name:attribute$BrowseName.value.name,qname:attribute$BrowseName.value,nodeId:nodeId4type,enumValues});if(!kh_js.isValid(baseType)||!kh_js.isValid(baseTypeId))nodes_to_rework.push(nodeId4type.toString());if(kh_js.isEmpty(parent4type?.references))break;nodeId4type=parent4type.references[0].nodeId}while(true);if(!kh_js.isEmpty(nodes_to_rework)){const last_key=nodes_to_rework.at(-1);let data_inf=this.#data_types_.get(last_key);while(kh_js.isValid(data_inf)&&false!=data_inf.parent_type)data_inf=this.#data_types_.get(data_inf.parent_type.toString());if(kh_js.isValid(data_inf)){const base_nodeId=data_inf.nodeId;if(0==base_nodeId.namespace){baseTypeId=base_nodeId.value;baseType=Util.DataTypeId2String(baseTypeId);nodes_to_rework.forEach((n2r=>{data_inf=this.#data_types_.get(n2r);data_inf.baseTypeId??=baseTypeId;data_inf.baseType??=baseType}))}}}return this.#data_types_.get(data_map_key_entry)}async readDataType(node_or_nodeId){if(!this.isConnected)return[];const nodeId=node_or_nodeId.nodeId??node_or_nodeId;const nodesToRead=[opcua.AttributeIds.DataType,opcua.AttributeIds.ValueRank,opcua.AttributeIds.ArrayDimensions].map((attributeId=>({nodeId,attributeId})));return this.NativeSession.read(nodesToRead).then((async dataValues=>{if(!Array.isArray(dataValues))throw new kh_js.Error({msg:["data-not-determined","during-execution","readDataType"]});const index=dataValues.findIndex((dataValue=>opcua.StatusCodes.Good!==dataValue.statusCode));if(-1==index||2==index){const baseTypeId=await this.NativeSession.getBuiltInDataType(nodeId);const baseType=Util.DataTypeId2String(baseTypeId)??dataValues[0].value.value;let nodeId4type=dataValues[0].value.value;const data_map_key=kh_js.isString(nodeId4type)?nodeId4type:nodeId4type.toString();const data_inf=await this.exploreTypeDefinition(data_map_key,baseTypeId,baseType);if(kh_js.isValid(baseType)){dataValues.push({realTypeId:dataValues[0].value?.value,realType:data_inf.name,baseType,baseTypeId,statusCode:opcua.StatusCodes.Good});dataValues[0].value.value=data_inf.name;dataValues[0].value.dataValue=opcua.DataTypeIds["String"]}}return dataValues})).catch((async error=>{kh_log.error?.(T9`error during ${kh_js.currentFunctionName()}= ${error}`);throw error}))}async#defSubscription({requestedPublishingInterval="PT0.100S",requestedMaxKeepAliveCount=100,requestedLifetimeCount=6e3,maxNotificationsPerPublish=1e3,publishingEnabled=true,priority=10}={}){if(!kh_js.isValid(this.#def_subscription_)||!this.#def_subscription_.isActive){try{if(kh_js.isString(requestedPublishingInterval))requestedPublishingInterval=DurationTime.Millis(requestedPublishingInterval);const subscription=await this.NativeSession.createSubscription2({requestedPublishingInterval,requestedMaxKeepAliveCount,requestedLifetimeCount,maxNotificationsPerPublish,publishingEnabled,priority});subscription.on("started",(()=>kh_log.info?.(T9`#*#*#* subscription is started`)));subscription.toJSON=get_toJSON(subscription);this.#def_subscription_=subscription}catch(error){kh_log.error?.(T9`error during ${kh_js.currentFunctionName()}= ${error}`);throw error}}return this.#def_subscription_}async deleteSubscription(subscription=this.#def_subscription_){if(kh_js.isValid(subscription)&&subscription.isActive){if(this.#def_subscription_==subscription)this.#def_subscription_=undefined;return subscription.terminate().then((()=>true))}return false}async monitor({subscription,itemToMonitor,requestedParameters,timeStampsToReturn=opcua.TimestampsToReturn.Both,monitoringMode=opcua.MonitoringMode.Reporting,removeAfter,getCurrent}={}){let subscriptionOpts;if(kh_js.isValid(subscription)){if("requestedPublishingInterval"in subscription||"requestedMaxKeepAliveCount"in subscription||"requestedLifetimeCount"in subscription||"maxNotificationsPerPublish"in subscription){subscriptionOpts=subscription;subscription=undefined}}if(!kh_js.isValid(subscription)){subscription=await this.#defSubscription(subscriptionOpts)}if(kh_js.isString(requestedParameters?.samplingInterval))requestedParameters.samplingInterval=DurationTime.Millis(requestedParameters.samplingInterval);const client_monitored_item=await subscription.monitor(itemToMonitor,requestedParameters,timeStampsToReturn,monitoringMode);client_monitored_item.toJSON=get_toJSON(client_monitored_item);const type_info=await this.readDataType(itemToMonitor.nodeId);if(true==getCurrent){const v=await this.NativeSession.read({nodeId:itemToMonitor.nodeId,attributeId:opcua.AttributeIds.Value});type_info.at(-1).value=v}removeAfter??=this.#options_.subscriptions?.["auto-delete"];if(kh_js.isValid(removeAfter)){if(kh_js.isString(removeAfter))removeAfter=DurationTime.Millis(removeAfter);if(0<removeAfter)kh_js.defer(removeAfter).then((()=>{if(client_monitored_item.subscription.hasSession)return client_monitored_item.terminate();else return Promise.reject(new kh_js.Error({msg:["error","during-execution","monitored item termination","session","param-ivalid"]}))})).catch((error=>kh_log.error?.(T9`error during monitored item termination ${client_monitored_item} => ${error}`)))}return{subscription,item:client_monitored_item,type_info}}}export class Util{static makeBrowsePath_(path){path=Util.#correctPath(path);return path?.split("/").map((s_item=>s_item.trim(`"'`).split(":"))).map((item_splitted=>({ns:1==item_splitted.length?0:item_splitted[0],name:item_splitted[item_splitted.length-1]})))}static makeBrowsePath(path){path=Util.#correctPath(path);return path&&opcua.makeBrowsePath("RootFolder",path)}static async translateBrowsePath(client,path){if(kh_js.isString(path))path=Util.makeBrowsePath(path);return client.NativeSession.translateBrowsePath(path)}static#correctPath(path){if(!kh_js.isEmpty(path)&&!path.startsWith("/"))path="/"+path;if(!kh_js.isEmpty(path)&&path.endsWith("/"))path=path.substring(0,path.length-1);return path}static cvtDataValue2String(dataValue,reduceLarge=true){if(!kh_js.isValid(dataValue))return"null";if(!dataValue.value?.hasOwnProperty("value"))return`<???> : ${dataValue.statusCode.toString()}`;let ret;switch(dataValue.value.arrayType){case opcua.VariantArrayType.Scalar:ret=dataValue.toString();break;case opcua.VariantArrayType.Array:ret=dataValue.toString();break;default:return""}if(reduceLarge&&512+5<ret.length){ret=ret.substring(0,256)+" ... "+ret.substring(ret.length-256,ret.length)}return ret}static cvtAttributeId2StringFromDataValue(attributeId,dataValue){if(!dataValue?.value?.hasOwnProperty("value"))return"null";switch(attributeId){case opcua.AttributeIds.DataType:{let nodeId=opcua.coerceNodeId(dataValue.value.value);if(kh_js.isValid(nodeId)&&0==nodeId.namespace)nodeId=nodeId.value;return`${Util.DataTypeId2String(nodeId)??"unknown or derived type"} (${dataValue.value.value.toString()})`}case opcua.AttributeIds.NodeClass:return`${opcua.NodeClass[dataValue.value.value]} (${dataValue.value.value})`;case opcua.AttributeIds.IsAbstract:case opcua.AttributeIds.Historizing:case opcua.AttributeIds.EventNotifier:return dataValue.value.value?"true":"false";case opcua.AttributeIds.WriteMask:case opcua.AttributeIds.UserWriteMask:return`(${dataValue.value.value})`;case opcua.AttributeIds.NodeId:case opcua.AttributeIds.BrowseName:case opcua.AttributeIds.DisplayName:case opcua.AttributeIds.Description:case opcua.AttributeIds.ValueRank:case opcua.AttributeIds.ArrayDimensions:case opcua.AttributeIds.Executable:case opcua.AttributeIds.UserExecutable:case opcua.AttributeIds.MinimumSamplingInterval:return dataValue.value?.value?.toString()??"null";case opcua.AttributeIds.UserAccessLevel:case opcua.AttributeIds.AccessLevel:{if(!dataValue.value.value)return"null";return`${opcua.accessLevelFlagToString(dataValue.value.value)} (${dataValue.value.value})`}default:return Util.cvtDataValue2String(dataValue)}}static defBrowseDesription({nodeId,includeSubtypes=true,referenceTypeId,browseDirection=opcua.BrowseDirection.Forward,nodeClassMask=0,resultMask=63}){if(!kh_js.isValid(nodeId))throw new kh_js.Error({msg:["invalid-argument","nodeId"]});return new opcua.BrowseDescription({nodeId,includeSubtypes,referenceTypeId,browseDirection,nodeClassMask,resultMask})}static AttributeId2String(attributeId){return opcua.AttributeIds[attributeId]}static String2AttributeId(attributeName){return opcua.AttributeIds[attributeName]}static DataTypeId2String(dataTypeId){return opcua.DataTypeIds[dataTypeId]}}Util.allAttributeIds??=(()=>{const allAttributeIds=[];for(let i=1;i<opcua.AttributeIds.AccessLevelEx;++i)allAttributeIds.push(opcua.AttributeIds[i]);return allAttributeIds})();kh_global.LoadedScripts.get(mf).resolve(ms);